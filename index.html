<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam Travel Treasury</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/SVRQLyT37WHaWfG08=" crossorigin=""/>
    <!-- Load Leaflet Marker Cluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <!-- Load Lucide Icons (for detail panel) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Map specific styles: ƒê·∫£m b·∫£o b·∫£n ƒë·ªì chi·∫øm ƒë√∫ng 50% chi·ªÅu cao viewport */
        #vietnam-map {
            height: 50vh; /* Chi·ªÅu cao c·ªë ƒë·ªãnh */
            width: 100%;
            border-radius: 0.5rem; /* rounded-lg */
            overflow: hidden; /* FIX: NgƒÉn ch·∫∑n b·∫•t k·ª≥ n·ªôi dung n√†o b√™n trong b·∫£n ƒë·ªì tr√†n ra */
        }
        
        /* FIX: Ensure the entire page respects bounding boxes */
        body {
            box-sizing: border-box;
            /* ƒê√£ lo·∫°i b·ªè min-height: 100vh ƒë·ªÉ tr√°nh xung ƒë·ªôt layout */
            overflow-x: hidden; /* Prevent horizontal overflow */
        }

        /* Styles cho danh s√°ch cu·ªôn ngang (Carousel/Slider) */
        .horizontal-scroll-list {
            display: flex;
            overflow-x: scroll; /* B·∫≠t cu·ªôn ngang */
            scroll-snap-type: x mandatory;
            padding-bottom: 1rem;
            scroll-behavior: smooth;
        }
        
        .horizontal-scroll-list > div {
            flex: 0 0 auto; /* ƒê·∫£m b·∫£o c√°c item kh√¥ng co l·∫°i */
            width: 280px; /* Chi·ªÅu r·ªông c·ªë ƒë·ªãnh c·ªßa card */
            scroll-snap-align: start;
            margin-right: 1rem;
        }

        /* Custom marker icon style */
        .custom-div-icon {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans p-4 sm:p-8">

    <!-- Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªïng th·ªÉ c·ªßa ·ª©ng d·ª•ng v√† cƒÉn gi·ªØa -->
    <div id="app" class="mx-auto max-w-7xl"> 
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-2">
                Vietnam Travel Treasury
            </h1>
            <p class="text-gray-600 text-lg">Kh√°m ph√°, t√¨m ki·∫øm v√† l·ªçc c√°c ƒëi·ªÉm check-in "s·ªëng ·∫£o" n·ªïi ti·∫øng nh·∫•t Vi·ªát Nam.</p>
        </header>

        <!-- Search bar and filter -->
        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg mb-8 space-y-4 md:flex md:space-y-0 md:space-x-4 mx-auto max-w-6xl">
            <!-- Search Input -->
            <input 
                type="text" 
                id="search-input" 
                placeholder="T√¨m ki·∫øm theo t√™n ƒë·ªãa ƒëi·ªÉm..."
                class="w-full md:flex-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
            >
            <!-- City Filter -->
            <select 
                type="text"
                id="city-filter" 
                class="w-full md:w-1/3 p-3 border border-gray-300 rounded-lg bg-white appearance-none focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                onchange="filterLocations()"
            >
                <option value="">-- L·ªçc theo T·ªânh/Th√†nh ph·ªë --</option>
            </select>
        </div>

        <!-- MAP WRAPPER CARD (Fixed container) -->
        <!-- ƒê√£ s·ª≠a l·ªói: Th√™m ID v√† lo·∫°i b·ªè template literal -->
        <h2 id="map-title" class="text-2xl font-bold text-gray-800 mb-4 text-center">
             üìç B·∫£n ƒë·ªì ƒê·ªãa ƒëi·ªÉm Check-in Vi·ªát Nam üáªüá≥
        </h2>
        <!-- Card ch·ª©a b·∫£n ƒë·ªì. Layout ƒë√£ ƒë∆∞·ª£c fix ƒë·ªÉ kh√¥ng tr√†n -->
        <div class="map-card-wrapper bg-white p-4 sm:p-6 rounded-2xl shadow-xl mx-auto max-w-6xl w-full mb-10 border-4 border-indigo-200">
            <!-- MAP CONTAINER INSIDE CARD (Fixed Height) -->
            <div id="vietnam-map"></div>
        </div>
        <!-- End Map Wrapper Card -->

        <!-- Container for the list of locations (Horizontal Slider/Carousel) -->
        <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4 border-b pb-2">
             Danh s√°ch ƒê·ªãa ƒëi·ªÉm Check-in G·ª£i √Ω H√†ng ƒë·∫ßu üìã
        </h2>
        <div 
            id="location-list" 
            class="horizontal-scroll-list mx-auto max-w-6xl"
        >
            <!-- Locations will be rendered here -->
            <p id="loading-message" class="text-center text-gray-500 p-8">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>

        <footer class="mt-10 text-center text-gray-500 text-sm border-t pt-4">
            &copy; 2025 Tourism Data. Map powered by Leaflet.
        </footer>
    </div>

    <!-- DETAIL PANEL (MODAL/SIDEBAR) -->
    <!-- S·ª≠ d·ª•ng fixed position v√† translate-x-full ƒë·ªÉ ·∫©n/hi·ªán m∆∞·ª£t m√† -->
    <div 
        id="detail-panel" 
        class="fixed top-0 right-0 w-full sm:w-96 h-full bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 overflow-y-auto p-6 space-y-6"
    >
        <div class="flex justify-between items-center border-b pb-3">
            <h3 class="text-xl font-extrabold text-indigo-700">Th√¥ng tin chi ti·∫øt</h3>
            <button onclick="closeDetailPanel()" class="text-gray-500 hover:text-red-500 transition">
                <!-- Close icon from Lucide -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>

        <div id="detail-content" class="space-y-4">
            <!-- N·ªôi dung chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn v√†o ƒë√¢y -->
            <h4 class="text-2xl font-bold text-gray-800" id="detail-name"></h4>
            <p class="text-sm font-semibold text-gray-600">
                <span class="font-normal text-indigo-500 text-base" id="detail-city"></span> (<span id="detail-region"></span>)
            </p>
            <div class="space-y-2">
                <p class="font-medium text-gray-700 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-2 text-red-500"><path d="M12 21.7C17.3 17 20 14.4 20 10.2C20 6.6 16.4 4 12 4C7.6 4 4 6.6 4 10.2C4 14.4 6.7 17 12 21.7Z"/><circle cx="12" cy="10" r="3"/></svg>
                    ƒê·ªãa ch·ªâ: <span class="ml-2 font-normal text-gray-600" id="detail-address"></span>
                </p>
                <p class="font-medium text-gray-700 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-compass mr-2 text-teal-500"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>
                    T·ªça ƒë·ªô ∆∞·ªõc t√≠nh: <span class="ml-2 font-normal text-gray-600" id="detail-coords"></span>
                </p>
            </div>
            
            <img src="" alt="H√¨nh ·∫£nh g·ª£i √Ω" id="detail-image" class="w-full h-auto object-cover rounded-lg shadow-md mt-4">

            <p class="font-bold text-lg text-gray-800 mt-4">Gi·ªõi thi·ªáu:</p>
            <p class="text-gray-600 italic" id="detail-intro"></p>
        </div>
    </div>
    <!-- END DETAIL PANEL -->
    
    <!-- C√ÅC TH∆Ø VI·ªÜN LEAFLET JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- K·∫æT TH√öC C√ÅC TH∆Ø VI·ªÜN LEAFLET JS -->

    <script>
        // Data provided by the user (78 locations)
        const userProvidedLocations = [
            {"name": "Old Quarter", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Ta Hien Street", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Tong Duy Tan Street", "address": "Hoan Kiem District, Hanoi"},
            {"name": "St. Joseph's Cathedral", "address": "40 Nha Chung Street, Hoan Kiem District, Hanoi"},
            {"name": "Train Street, Tran Phu", "address": "Ba Dinh District, Hanoi"},
            {"name": "Ho Chi Minh Mausoleum", "address": "2 Hung Vuong Street, Ba Dinh District, Hanoi"},
            {"name": "Hoan Kiem Lake", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Long Bien Bridge", "address": "Connecting Long Bien and Ba Dinh Districts, Hanoi"},
            {"name": "One Pillar Pagoda", "address": "Dien Bien Ward, Ba Dinh District, Hanoi"},
            {"name": "Temple of Literature", "address": "58 Quoc Tu Giam Street, Dong Da District, Hanoi"},
            
            {"name": "Notre-Dame Cathedral Basilica of Saigon", "address": "1 Cong xa Paris, District 1, Ho Chi Minh City"},
            {"name": "Saigon Central Post Office", "address": "2 Cong xa Paris, District 1, Ho Chi Minh City"},
            {"name": "Ben Thanh Market", "address": "45 Le Loi, District 1, Ho Chi Minh City"},
            {"name": "Bitexco Financial Tower", "address": "2 Hai Trieu, District 1, Ho Chi Minh City"},
            {"name": "Tan Dinh Church (Pink Church)", "address": "289 Hai Ba Trung, District 1, Ho Chi Minh City"},
            {"name": "Cafe Apartment", "address": "42-44 Nguyen Hue Street, District 1, Ho Chi Minh City"},
            {"name": "Suoi Tien Theme Park", "address": "120 Xa Lo Ha Noi, District 9, Ho Chi Minh City"},
            {"name": "Nguyen Van Binh Book Street", "address": "9 Nguyen Van Binh, District 1, Ho Chi Minh City"},
            {"name": "23/9 Park", "address": "District 1, Ho Chi Minh City"},
            {"name": "Bui Vien Street", "address": "District 1, Ho Chi Minh City"},
            
            {"name": "Hoi An Ancient Town", "address": "Minh An Ward, Hoi An City, Quang Nam"},
            {"name": "Japanese Covered Bridge", "address": "Hoi An Ancient Town, Quang Nam"},
            {"name": "Cau Pagoda", "address": "Hoi An Ancient Town, Quang Nam"},
            {"name": "Cam Thanh Coconut Forest", "address": "Cam Thanh Commune, Hoi An, Quang Nam"},
            {"name": "An Bang Beach", "address": "Cam An Commune, Hoi An, Quang Nam"},
            {"name": "Thanh Ha Pottery Village", "address": "Thanh Ha Ward, Hoi An, Quang Nam"},
            {"name": "Hoi An History Museum", "address": "Hoi An Ancient Town, Quang Nam"},
            
            {"name": "Golden Bridge, Ba Na Hills", "address": "An Son Hamlet, Hoa Ninh Commune, Hoa Vang District, Da Nang"},
            {"name": "Dragon Bridge", "address": "Hai Chau District, Da Nang"},
            {"name": "My Khe Beach", "address": "Son Tra District, Da Nang"},
            {"name": "Marble Mountains", "address": "Ngu Hanh Son District, Da Nang"},
            {"name": "Cham Museum", "address": "2 Phan Chau Trinh, Hai Chau District, Da Nang"},
            {"name": "Han River Bridge", "address": "Hai Chau District, Da Nang"},
            
            {"name": "Ha Long Bay", "address": "Ha Long City, Quang Ninh"},
            {"name": "Bai Chay Bridge", "address": "Ha Long City, Quang Ninh"},
            {"name": "Bai Chay Resort", "address": "Ha Long City, Quang Ninh"},
            
            {"name": "Rong May Glass Bridge", "address": "Sapa, Lao Cai"},
            {"name": "Ham Rong Mountain", "address": "Sapa Town, Lao Cai"},
            {"name": "Silver Waterfall", "address": "Sapa, Lao Cai"},
            {"name": "Muong Hoa Terraces", "address": "Sapa, Lao Cai"},
            {"name": "Sapa Market", "address": "Sapa Town, Lao Cai"},
            
            {"name": "Trang An Ecotourism Complex", "address": "Gia Vien District, Ninh Binh"},
            {"name": "Tam Coc - Bich Dong", "address": "Ninh Hai Commune, Ninh Binh"},
            {"name": "Hang Mua", "address": "Ninh Hai Commune, Ninh Binh"},
            {"name": "Bai Dinh Pagoda", "address": "Gia Vien District, Ninh Binh"},
            {"name": "Phat Diem Stone Cathedral", "address": "Kim Son District, Ninh Binh"},
            
            {"name": "Bai Sao Beach", "address": "Phu Quoc Island, Kien Giang"},
            {"name": "Vinpearl Land Phu Quoc", "address": "Ganh Dau, Phu Quoc, Kien Giang"},
            {"name": "Phu Quoc Fish Sauce Factory", "address": "An Thoi, Phu Quoc, Kien Giang"},
            {"name": "Dinh Cau Night Market", "address": "Duong Dong Town, Phu Quoc, Kien Giang"},
            
            {"name": "Xuan Huong Lake", "address": "City Center, Da Lat, Lam Dong"},
            {"name": "Valley of Love", "address": "Ward 8, Da Lat, Lam Dong"},
            {"name": "Domain De Marie Church", "address": "1 Tran Phu Street, Da Lat"},
            {"name": "Tuyen Lam Lake", "address": "Ward 3, Da Lat"},
            {"name": "Pongour Waterfall", "address": "Duc Trong District, Lam Dong"},
            {"name": "Crazy House", "address": "3 Huynh Thuc Khang, Da Lat"},
            
            {"name": "Cu Lao Cham", "address": "Hoi An, Quang Nam"},
            {"name": "Nguyen Hue Walking Street", "address": "District 1, Ho Chi Minh City"},
            {"name": "Duong Lam Ancient Village", "address": "Son Tay Town, Hanoi"},
            {"name": "Hung Kings Temple", "address": "Phu Tho"},
            {"name": "West Lake", "address": "Tay Ho District, Hanoi"},
            {"name": "Suoi Ca Than Hot Spring", "address": "C·∫©m L∆∞∆°ng, Quang Nam"},
            {"name": "Bai Da Trung", "address": "Quang Binh"},
            {"name": "Cuc Phuong National Park", "address": "Ninh Binh"},
            {"name": "Ly Son Island", "address": "Quang Ngai"},
            {"name": "Hai Van Pass", "address": "Border of Hue and Da Nang"},
            {"name": "Quang Tri Citadel", "address": "Quang Tri"},
            {"name": "Thien Mu Pagoda", "address": "Hue"},
            {"name": "My Khe Beach", "address": "Da Nang"},
            {"name": "Phu My Hung Urban Area", "address": "District 7, Ho Chi Minh City"},
            {"name": "An Thoi Diving Site", "address": "Phu Quoc, Kien Giang"},
            {"name": "Tan Trao Banyan Tree", "address": "Tuyen Quang"},
            {"name": "Can Gio Mangrove Forest", "address": "Ho Chi Minh City"},
            {"name": "Mui Ne Beach", "address": "Binh Thuan"},
            {"name": "Nguyen Hue Flower Street", "address": "District 1, Ho Chi Minh City"},
            {"name": "Vietnam Museum of Ethnology", "address": "Nguyen VƒÉn Huyen, Cau Giay, Hanoi"},
            {"name": "Dong Xuan Market", "address": "Hoan Kiem, Hanoi"},
            {"name": "Tu Duc Tomb", "address": "Hue"},
            {"name": "Poshanu Cham Towers", "address": "Ninh Thuan"},
            {"name": "Hue Ancient Town", "address": "Hue"},
            {"name": "Phat Diem Stone Church", "address": "Kim Son, Ninh Binh"},
            {"name": "Ba Vi National Park", "address": "Ba Vi, Hanoi"},
            {"name": "Thap Ba Hot Spring", "address": "Nha Trang, Khanh Hoa"},
            {"name": "Ba Den Mountain", "address": "Tay Ninh"},
            {"name": "Ancient Village Communal House", "address": "Bac Ninh"},
            {"name": "Dai Nam Tourism Complex", "address": "Binh Duong"},
            {"name": "Suoi Mo Waterfall", "address": "Dong Nai"},
            {"name": "Long Bien Bridge", "address": "Hanoi"},
            {"name": "Cua Lo Beach", "address": "Nghe An"},
            {"name": "Thien Son-Hoan Nga Ecotourism", "address": "Ba Vi, Hanoi"},
            {"name": "Nui Coc Lake Tourist Area", "address": "Thai Nguyen"},
            {"name": "Hung Kings Temple", "address": "Phu Tho"},
            {"name": "Cai Rang Floating Market", "address": "Can Tho"},
            {"name": "Cat Ba Island", "address": "Hai Phong"},
            {"name": "Hai Phong Cathedral", "address": "Hai Phong"},
            {"name": "Quan Lan Island", "address": "Quang Ninh"},
            {"name": "Cua Lo Fishing Port", "address": "Nghe An"},
            {"name": "Luy Lau Ancient Citadel", "address": "Bac Ninh"},
            {"name": "Ho Tram Beach", "address": "Ba Ria - Vung Tau"},
            {"name": "Ba Dinh Square", "address": "Hanoi"}
        ];
        
        // --- JAVASCRIPT LOGIC AREA ---

        const locationListElement = document.getElementById('location-list');
        const searchInputElement = document.getElementById('search-input');
        const cityFilterElement = document.getElementById('city-filter');
        const detailPanel = document.getElementById('detail-panel');

        let autoScrollInterval; 
        
        // Map variables
        let vietnamMap;
        let markerClusterGroup;

        // Map of cities/regions to approximate coordinates (for plotting/clustering)
        const cityCoordinates = {
            // North
            "Hanoi": { lat: 21.0285, lng: 105.8542, region: 'B·∫Øc' },
            "Hai Phong": { lat: 20.8449, lng: 106.6881, region: 'B·∫Øc' },
            "Quang Ninh": { lat: 20.9572, lng: 107.0350, region: 'B·∫Øc' },
            "Lao Cai": { lat: 22.3390, lng: 103.8500, region: 'B·∫Øc' },
            "Phu Tho": { lat: 21.3204, lng: 105.4055, region: 'B·∫Øc' },
            "Tuyen Quang": { lat: 21.7825, lng: 105.2104, region: 'B·∫Øc' },
            "Bac Ninh": { lat: 21.1894, lng: 106.0711, region: 'B·∫Øc' },
            "Thai Nguyen": { lat: 21.5975, lng: 105.8456, region: 'B·∫Øc' },
            "Ninh Binh": { lat: 20.2500, lng: 105.9000, region: 'B·∫Øc' },
            "Nghe An": { lat: 18.6750, lng: 105.6880, region: 'B·∫Øc' }, // G·∫ßn nh∆∞ Trung nh∆∞ng v·ªÅ h√†nh ch√≠nh ƒë·ªãa l√Ω l√† B·∫Øc Trung B·ªô
            
            // Central
            "Quang Binh": { lat: 17.4764, lng: 106.6006, region: 'Trung' },
            "Quang Tri": { lat: 16.8208, lng: 107.0855, region: 'Trung' },
            "Hue": { lat: 16.4680, lng: 107.5707, region: 'Trung' },
            "Da Nang": { lat: 16.0544, lng: 108.2022, region: 'Trung' },
            "Quang Nam": { lat: 15.8794, lng: 108.3360, region: 'Trung' },
            "Quang Ngai": { lat: 15.1167, lng: 108.8000, region: 'Trung' },
            "Ninh Thuan": { lat: 11.5833, lng: 108.9667, region: 'Trung' },
            "Khanh Hoa": { lat: 12.2458, lng: 109.1947, region: 'Trung' },

            // South
            "Binh Thuan": { lat: 10.9344, lng: 108.2711, region: 'Nam' },
            "Ho Chi Minh City": { lat: 10.7758, lng: 106.7013, region: 'Nam' },
            "Ba Ria - Vung Tau": { lat: 10.5519, lng: 107.4190, region: 'Nam' },
            "Dong Nai": { lat: 10.9500, lng: 107.0500, region: 'Nam' },
            "Binh Duong": { lat: 11.0000, lng: 106.6750, region: 'Nam' },
            "Tay Ninh": { lat: 11.3167, lng: 106.1167, region: 'Nam' },
            "Kien Giang": { lat: 10.2241, lng: 103.9577, region: 'Nam' }, // Phu Quoc
            "Lam Dong": { lat: 11.9400, lng: 108.4420, region: 'Nam' }, // Da Lat
            "Can Tho": { lat: 10.0333, lng: 105.7833, region: 'Nam' },
            "Other": { lat: 16.0, lng: 107.8, region: 'Trung' }
        };


        /**
         * Extracts the city/province name from the address string.
         */
        function extractCity(address) {
            if (!address) return "Other";
            
            // Regex to find common Vietnamese provinces or major city names
            const cityMatch = address.match(/(Hanoi|Ha Noi|Ho Chi Minh City|H·ªì Ch√≠ Minh|ƒê√† N·∫µng|Da Nang|Quang Nam|Qu·∫£ng Nam|Hu·∫ø|Hue|Ninh Binh|Ninh B√¨nh|Lao Cai|L√†o Cai|Quang Ninh|Qu·∫£ng Ninh|Kien Giang|Ki√™n Giang|Phu Quoc|Ph√∫ Qu·ªëc|Lam Dong|L√¢m ƒê·ªìng|ƒê√† L·∫°t|Da Lat|Can Tho|C·∫ßn Th∆°|Hai Phong|H·∫£i Ph√≤ng|Phu Tho|Ph√∫ Th·ªç|Tuyen Quang|Tuy√™n Quang|Bac Ninh|B·∫Øc Ninh|Thai Nguyen|Th√°i Nguy√™n|Nghe An|Ngh·ªá An|Quang Binh|Qu·∫£ng B√¨nh|Quang Tri|Qu·∫£ng Tr·ªã|Quang Ngai|Qu·∫£ng Ng√£i|Ninh Thuan|Ninh Thu·∫≠n|Khanh Hoa|Kh√°nh H√≤a|Nha Trang|Binh Thuan|B√¨nh Thu·∫≠n|Ba Ria - Vung Tau|B√† R·ªãa|Vung Tau|V≈©ng T√†u|Dong Nai|ƒê·ªìng Nai|Binh Duong|B√¨nh D∆∞∆°ng|Tay Ninh|T√¢y Ninh)/i);

            if (cityMatch) {
                // Standardize city name (e.g., "H·ªì Ch√≠ Minh" -> "Ho Chi Minh City")
                const city = cityMatch[0];
                if (city.includes("H·ªì Ch√≠ Minh") || city.includes("Ho Chi Minh City")) return "Ho Chi Minh City";
                if (city.includes("Hanoi") || city.includes("Ha Noi")) return "Hanoi";
                if (city.includes("ƒê√† N·∫µng")) return "Da Nang";
                if (city.includes("Qu·∫£ng Nam")) return "Quang Nam";
                if (city.includes("Hu·∫ø")) return "Hue";
                if (city.includes("L√¢m ƒê·ªìng") || city.includes("ƒê√† L·∫°t")) return "Lam Dong";
                if (city.includes("Ki√™n Giang") || city.includes("Ph√∫ Qu·ªëc")) return "Kien Giang";
                return city; 
            }
            
            return "Other";
        }

        /**
         * Processes the user data, assigns estimated coordinates, and determines the region.
         */
        function processLocations(raw) {
            // Using a smaller jitter for closer grouping
            const JITTER = 0.015; 
            
            return raw.map(loc => {
                const city = extractCity(loc.address);
                const coords = cityCoordinates[city] || cityCoordinates["Other"];
                
                // Add small random offset for clustering visual effect
                const latOffset = (Math.random() - 0.5) * JITTER; 
                const lngOffset = (Math.random() - 0.5) * JITTER; 
                
                return {
                    ...loc,
                    city: city,
                    region: coords.region,
                    lat: parseFloat((coords.lat + latOffset).toFixed(4)),
                    lng: parseFloat((coords.lng + lngOffset).toFixed(4))
                };
            });
        }

        const locations = processLocations(userProvidedLocations);

        function populateCityFilter() {
            const cities = new Set(locations.map(loc => loc.city).filter(c => c !== "Other"));
            
            const priorityOrder = ["Hanoi", "Ho Chi Minh City", "Da Nang", "Quang Nam", "Lam Dong", "Kien Giang", "Quang Ninh", "Hue"];
            
            const sortedCities = Array.from(cities).sort((a, b) => {
                const aIndex = priorityOrder.indexOf(a);
                const bIndex = priorityOrder.indexOf(b);
                if (aIndex === -1 && bIndex === -1) return a.localeCompare(b);
                if (aIndex !== -1 && bIndex === -1) return -1;
                if (aIndex === -1 && bIndex !== -1) return 1;
                return aIndex - bIndex;
            });
            
            sortedCities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilterElement.appendChild(option);
            });
        }

        // --- DETAIL PANEL LOGIC ---

        function getMarkerColor(region) {
             if (region === 'B·∫Øc') return '#1d4ed8'; // Blue
             if (region === 'Trung') return '#059669'; // Green
             return '#dc2626'; // Red
        }

        /**
         * Populates the detail panel with location info and shows it.
         * @param {Object} loc - The location object.
         */
        function showLocationDetails(loc) {
            document.getElementById('detail-name').textContent = loc.name;
            document.getElementById('detail-city').textContent = loc.city;
            document.getElementById('detail-region').textContent = loc.region;
            document.getElementById('detail-address').textContent = loc.address;
            document.getElementById('detail-coords').textContent = `${loc.lat}, ${loc.lng}`;
            document.getElementById('detail-intro').textContent = getPlaceholderIntro(loc);
            
            const detailImage = document.getElementById('detail-image');
            detailImage.src = getImageUrl(loc);
            detailImage.onerror = function() { 
                this.src = 'https://placehold.co/400x200/d1d5db/374151?text=Image+Unavailable';
            };

            // Slide in the panel (remove translate-x-full)
            detailPanel.classList.remove('translate-x-full');

            // Zoom map to the clicked marker
            if (vietnamMap) {
                 vietnamMap.setView([loc.lat, loc.lng], 14, { animate: true });
            }
        }

        function closeDetailPanel() {
            // Slide out the panel (add translate-x-full)
            detailPanel.classList.add('translate-x-full');
        }

        // --- MAP INITIALIZATION AND RENDERING ---

        function initMap() {
            if (typeof L === 'undefined' || typeof L.map !== 'function') {
                console.error("Leaflet is not defined. Cannot initialize map.");
                return;
            }

            vietnamMap = L.map('vietnam-map', {
                center: [16.0, 107.8], // Central Vietnam
                zoom: 5,
                minZoom: 5,
                maxZoom: 18,
                zoomControl: true 
            });

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(vietnamMap);

            if (typeof L.markerClusterGroup !== 'function') {
                console.error("L.markerClusterGroup is not defined. Marker Cluster plugin failed to load.");
                return;
            }
            markerClusterGroup = L.markerClusterGroup({
                chunkedLoading: true,
                spiderfyOnMaxZoom: true 
            });
            vietnamMap.addLayer(markerClusterGroup);

            // FIX: Force map size recalculation after a short delay
            setTimeout(() => {
                vietnamMap.invalidateSize();
                const bounds = locations.map(loc => [loc.lat, loc.lng]);
                if (bounds.length > 0) {
                     vietnamMap.fitBounds(bounds, { padding: [20, 20] });
                }
            }, 500); // 500ms delay helps with container size issues
        }

        function updateMapMarkers(filteredList) {
            if (typeof L === 'undefined' || !markerClusterGroup) return; 

            markerClusterGroup.clearLayers();

            filteredList.forEach(loc => {
                if (loc.lat && loc.lng) {
                    let markerColor = getMarkerColor(loc.region);

                    // C·∫¨P NH·∫¨T: TƒÉng k√≠ch th∆∞·ªõc marker ƒë·ªÉ d·ªÖ nh√¨n h∆°n (20px thay v√¨ 10px)
                    const iconSize = 20;
                    const customIcon = L.divIcon({
                        className: 'custom-div-icon',
                        // S·ª≠ d·ª•ng border #f9fafb (g·∫ßn tr·∫Øng) cho vi·ªÅn ngo√†i v√† ƒë·ªï b√≥ng r√µ r·ªát h∆°n
                        html: `<div style="background-color: ${markerColor}; width: ${iconSize}px; height: ${iconSize}px; border-radius: 50%; border: 3px solid #f9fafb; box-shadow: 0 4px 8px rgba(0,0,0,0.3); opacity: 0.9; cursor: pointer;"></div>`,
                        iconSize: [iconSize + 6, iconSize + 6], // K√≠ch th∆∞·ªõc t·ªïng th·ªÉ c·ªßa divIcon
                        iconAnchor: [(iconSize + 6) / 2, (iconSize + 6) / 2] // ƒê·∫∑t anchor v√†o gi·ªØa
                    });

                    // Marker uses click event to show detail panel
                    const marker = L.marker([loc.lat, loc.lng], { icon: customIcon });
                    
                    // Add a simple tooltip for hover behavior
                    marker.bindTooltip(loc.name, { permanent: false, direction: 'top', offset: [0, -10] });

                    // Add click handler to show the detail panel
                    marker.on('click', () => showLocationDetails(loc));

                    marker.addTo(markerClusterGroup);
                }
            });
        }


        // --- AUTO-SCROLL LOGIC ---

        function startAutoScroll() {
            stopAutoScroll(); 

            const scrollDistance = 296; 
            const listElement = document.getElementById('location-list');
            const totalWidth = listElement.scrollWidth;

            autoScrollInterval = setInterval(() => {
                let nextScrollLeft = listElement.scrollLeft + scrollDistance;
                
                if (nextScrollLeft >= totalWidth - listElement.clientWidth) {
                    listElement.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    listElement.scrollTo({ left: nextScrollLeft, behavior: 'smooth' });
                }
            }, 5000); // 5 gi√¢y
        }

        function stopAutoScroll() {
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
            }
        }


        // --- RENDER & FILTER LOGIC ---
        
        function getImageUrl(loc) {
            const keywords = loc.name.split('(')[0].trim().replace(/\s/g, '+');
            let color;
            if (loc.region === 'B·∫Øc') color = '5c7399'; 
            else if (loc.region === 'Trung') color = '419188'; 
            else color = 'a8464a'; 
            
            return `https://placehold.co/260x150/${color}/ffffff?text=${encodeURIComponent(keywords)}&font=roboto`;
        }

        function getPlaceholderIntro(loc) {
             const lowerCity = loc.city.toLowerCase();

            if (lowerCity.includes("hanoi") || lowerCity.includes("ho chi minh city")) {
                return "L√† trung t√¢m vƒÉn h√≥a, kinh t·∫ø v√† du l·ªãch l·ªõn nh·∫•t c·ªßa Vi·ªát Nam. N∆°i ƒë√¢y t·∫≠p trung nhi·ªÅu di t√≠ch l·ªãch s·ª≠, ki·∫øn tr√∫c c·ªï k√≠nh v√† khu ph·ªë hi·ªán ƒë·∫°i s√¥i ƒë·ªông.";
            } else if (lowerCity.includes("ƒë√† l·∫°t") || lowerCity.includes("sapa")) {
                 return "V√πng ƒë·∫•t c·ªßa s∆∞∆°ng m√π, kh√≠ h·∫≠u m√°t m·∫ª quanh nƒÉm, n·ªïi ti·∫øng v·ªõi ki·∫øn tr√∫c ƒë·ªôc ƒë√°o, th√°c n∆∞·ªõc h√πng vƒ© v√† c·∫£nh quan n√∫i r·ª´ng th∆° m·ªông.";
            } else if (loc.region === 'B·∫Øc') {
                 return "V√πng ƒë·∫•t gi√†u truy·ªÅn th·ªëng l·ªãch s·ª≠, n·ªïi b·∫≠t v·ªõi v·∫ª ƒë·∫πp h√πng vƒ© c·ªßa n√∫i r·ª´ng, c√°c di s·∫£n th·∫ø gi·ªõi nh∆∞ V·ªãnh H·∫° Long, v√† vƒÉn h√≥a d√¢n t·ªôc ƒë·ªôc ƒë√°o.";
            } else if (lowerCity.includes("ki√™n giang") || lowerCity.includes("ph√∫ qu·ªëc")) {
                 return "Thi√™n ƒë∆∞·ªùng bi·ªÉn ƒë·∫£o ph√≠a Nam, thu h√∫t du kh√°ch b·ªüi nh·ªØng b√£i bi·ªÉn hoang s∆°, c√°t tr·∫Øng, n∆∞·ªõc bi·ªÉn trong xanh v√† c√°c khu ngh·ªâ d∆∞·ª°ng cao c·∫•p.";
            } else if (lowerCity.includes("c·∫ßn th∆°")) {
                 return "Th·ªß ph·ªß c·ªßa mi·ªÅn T√¢y Nam B·ªô, n·ªïi ti·∫øng v·ªõi vƒÉn h√≥a s√¥ng n∆∞·ªõc, ch·ª£ n·ªïi C√°i RƒÉng v√† nh·ªØng mi·ªát v∆∞·ªùn tr√°i c√¢y tr√π ph√∫.";
            } else if (loc.region === 'Trung') {
                 return "V√πng ƒë·∫•t di s·∫£n, n∆°i giao thoa gi·ªØa l·ªãch s·ª≠ c·ªï k√≠nh (Hu·∫ø, H·ªôi An) v√† s·ª± ph√°t tri·ªÉn nƒÉng ƒë·ªông (ƒê√† N·∫µng), c√πng nhi·ªÅu b√£i bi·ªÉn ƒë·∫πp v√† ƒë√®o H·∫£i V√¢n n·ªïi ti·∫øng.";
            }
            return "ƒê·ªãa ƒëi·ªÉm du l·ªãch ƒë·ªôc ƒë√°o, ƒëang ch·ªù b·∫°n kh√°m ph√° v√† check-in!";
        }

        function renderLocations(filteredList) {
            locationListElement.innerHTML = '';
            
            if (filteredList.length === 0) {
                locationListElement.innerHTML = '<p class="text-center text-xl text-red-500 font-medium p-10 bg-yellow-50 rounded-xl shadow-inner mx-auto w-full">Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm n√†o ph√π h·ª£p v·ªõi ti√™u ch√≠ t√¨m ki·∫øm/l·ªçc.</p>';
                stopAutoScroll();
                return;
            }

            const listToShow = filteredList.slice(0, 10);

            listToShow.forEach(loc => {
                const item = document.createElement('div');
                item.className = 'loc-card bg-white p-4 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] border border-gray-100 cursor-pointer flex flex-col justify-between';
                
                // Khi click v√†o card, hi·ªÉn th·ªã detail panel v√† zoom map
                item.addEventListener('click', () => {
                    showLocationDetails(loc);
                });

                const icon = loc.city.includes("Hanoi") || loc.city.includes("Hue") ? 'üèõÔ∏è' : 
                             loc.city.includes("Ho Chi Minh City") ? 'üèôÔ∏è' : 
                             loc.city.includes("Da Nang") || loc.city.includes("Quang Nam") ? '‚õ±Ô∏è' :
                             loc.city.includes("Kien Giang") ? 'üèùÔ∏è' :
                             loc.city.includes("Lam Dong") || loc.city.includes("Lao Cai") ? '‚õ∞Ô∏è' : 'üáªüá≥';

                const shortIntro = getPlaceholderIntro(loc);
                const imageUrl = getImageUrl(loc); 
                
                item.innerHTML = `
                    <div>
                        <div class="flex items-center space-x-3 mb-2 border-b pb-2">
                            <span class="text-2xl">${icon}</span>
                            <h2 class="text-lg font-bold text-indigo-600 leading-tight">${loc.name}</h2>
                        </div>
                        <img 
                            src="${imageUrl}" 
                            alt="H√¨nh ·∫£nh g·ª£i √Ω cho ${loc.name}" 
                            class="w-full h-auto object-cover rounded-lg mb-3 shadow-inner"
                            onerror="this.onerror=null;this.src='https://placehold.co/260x150/d1d5db/374151?text=Image+Unavailable';"
                        >
                        <p class="text-xs font-medium text-gray-500 bg-indigo-50 inline-block px-2 py-0.5 rounded-full mb-3">
                            ${loc.city} (${loc.region})
                        </p>
                        <p class="text-sm text-gray-800 mb-2 font-semibold">Gi·ªõi thi·ªáu:</p>
                        <p class="text-sm text-gray-600 italic leading-snug">
                            ${shortIntro}
                        </p>
                    </div>
                    <div class="h-10"></div> 
                `;
                locationListElement.appendChild(item);
            });
            
            updateMapMarkers(filteredList);
            
            const hasFilter = searchInputElement.value.trim() || cityFilterElement.value;
            if (!hasFilter && listToShow.length > 0) {
                 startAutoScroll();
            } else {
                 stopAutoScroll(); 
            }
        }

        function filterLocations() {
            const searchTerm = searchInputElement.value.toLowerCase().trim();
            const selectedCity = cityFilterElement.value;

            const filtered = locations.filter(loc => {
                const matchesSearch = loc.name.toLowerCase().includes(searchTerm) || 
                                      loc.address.toLowerCase().includes(searchTerm);
                
                const matchesCity = !selectedCity || loc.city === selectedCity;

                return matchesSearch && matchesCity;
            });

            renderLocations(filtered);
        }

        // --- INITIALIZATION ---

        searchInputElement.addEventListener('input', filterLocations);
        cityFilterElement.addEventListener('change', filterLocations); 

        // H√†m kh·ªüi t·∫°o ch√≠nh
        function initializeApp() {
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) loadingMessage.style.display = 'none';

            // FIX: C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ b·∫£n ƒë·ªì v·ªõi s·ªë l∆∞·ª£ng ƒë·ªãa ƒëi·ªÉm ch√≠nh x√°c
            const mapTitleElement = document.getElementById('map-title');
            if (mapTitleElement) {
                mapTitleElement.innerHTML = `üìç B·∫£n ƒë·ªì ${locations.length} ƒê·ªãa ƒëi·ªÉm Check-in Vi·ªát Nam üáªüá≥`;
            }

            try {
                initMap(); 
                populateCityFilter();
                renderLocations(locations); 
            } catch (e) {
                console.error("Error during app initialization:", e);
            }
        }

        window.onload = initializeApp;
    </script>
</body>
</html>
