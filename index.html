<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bản đồ Du lịch Việt Nam (Leaflet.js)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; 
        }
        #leaflet-map {
            width: 100%;
            height: 60vh;
            margin: 0 auto;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px !important;
        }
        .leaflet-popup-content {
            font-weight: 500;
        }
        /* Style for Carousel */
        .carousel-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .carousel-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="mx-auto max-w-7xl text-center"> 
        <header class="mb-6">
            <h1 class="text-3xl font-extrabold text-indigo-700 mb-1">
                Bản đồ Du lịch Chi tiết Việt Nam
            </h1>
            <p class="text-gray-600">Sử dụng Leaflet.js và OpenStreetMap để hiển thị các điểm đến.</p>
        </header>

        <div class="mb-6 max-w-4xl mx-auto flex flex-wrap gap-3 justify-center">
            <input type="text" id="name-search-input" placeholder="Tìm theo tên hoặc địa chỉ..." 
                   class="flex-grow p-3 border-2 border-indigo-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 shadow-md min-w-[250px]">
            
            <select id="city-filter" 
                    class="w-40 p-3 border-2 border-indigo-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 shadow-md bg-white">
                <option value="">Lọc theo Thành phố</option>
            </select>

            <select id="category-filter"
                    class="w-48 p-3 border-2 border-indigo-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 shadow-md bg-white">
                <option value="">Lọc theo Loại hình</option>
            </select>
        </div>

        <div id="leaflet-map" class="max-w-4xl mx-auto mb-6"></div>
        
    </div>

    <div class="mt-12 max-w-7xl mx-auto" 
         x-data="carousel()" 
         x-init="init()">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Khám phá các điểm đến hàng đầu</h2>

        <div class="relative">
            <div x-ref="container" class="carousel-container flex overflow-x-auto snap-x snap-mandatory scroll-smooth">
                </div>

            <button @click="prev()" class="absolute top-1/2 left-0 -translate-y-1/2 bg-white/80 backdrop-blur-sm rounded-full p-2 text-gray-700 hover:bg-white transition shadow-md -ml-4 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button @click="next()" class="absolute top-1/2 right-0 -translate-y-1/2 bg-white/80 backdrop-blur-sm rounded-full p-2 text-gray-700 hover:bg-white transition shadow-md -mr-4 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>
    </div>


    <script>
        // --- DỮ LIỆU ĐỊA ĐIỂM ---
        const rawLocations = [
            // MIỀN BẮC
            [21.0287, 105.8522, "Hồ Hoàn Kiếm (Hồ Gươm)", "Quận Hoàn Kiếm", "Hà Nội", "Danh lam thắng cảnh", "Danh lam thắng cảnh/Di tích", "https://i.imgur.com/Y1N6uG2.jpg"],
            [21.0368, 105.8342, "Lăng Chủ tịch Hồ Chí Minh", "Số 2 Hùng Vương, Quận Ba Đình", "Hà Nội", "Danh lam thắng cảnh", "Di tích lịch sử", "https://i.imgur.com/8Qp4923.jpg"],
            [21.0278, 105.8355, "Văn Miếu - Quốc Tử Giám", "Số 58 Quốc Tử Giám, Quận Đống Đa", "Hà Nội", "Danh lam thắng cảnh", "Di tích lịch sử/Văn hóa", "https://i.imgur.com/8l7b8hH.jpg"],
            [21.0353, 105.8395, "Hoàng thành Thăng Long", "Số 19 Hoàng Diệu, Quận Ba Đình", "Hà Nội", "Danh lam thắng cảnh", "Di tích lịch sử/Văn hóa", "https://i.imgur.com/0vUnV5G.jpg"],
            [21.0325, 105.8488, "Phố cổ Hà Nội", "Quận Hoàn Kiếm", "Hà Nội", "Danh lam thắng cảnh", "Văn hóa/Du lịch", "https://i.imgur.com/g8S226J.jpg"],
            [20.9531, 107.0756, "Vịnh Hạ Long", "Thành phố Hạ Long", "Quảng Ninh", "Danh lam thắng cảnh", "Kỳ quan thiên nhiên Thế giới", "https://i.imgur.com/K5f46s9.jpg"],
            [21.1681, 106.7325, "Quần thể di tích Yên Tử", "Xã Thượng Yên Công, TP. Uông Bí", "Quảng Ninh", "Danh lam thắng cảnh", "Di tích lịch sử/Tâm linh", "https://i.imgur.com/i9Td2pq.jpg"],
            [20.9750, 107.7500, "Đảo Cô Tô", "Huyện Cô Tô", "Quảng Ninh", "Danh lam thắng cảnh", "Du lịch biển/Đảo", "https://i.imgur.com/P5G2oU7.jpg"],
            [20.2558, 105.9183, "Quần thể danh thắng Tràng An", "Huyện Hoa Lư, TP. Ninh Bình", "Ninh Bình", "Danh lam thắng cảnh", "Di sản UNESCO", "https://i.imgur.com/1Oq2E9z.jpg"],
            [20.2458, 105.9525, "Cố đô Hoa Lư", "Xã Trường Yên, Huyện Hoa Lư", "Ninh Bình", "Danh lam thắng cảnh", "Di tích lịch sử/Văn hóa", "https://i.imgur.com/sXh8w0W.jpg"],
            [20.2833, 105.9233, "Chùa Bái Đính", "Xã Gia Sinh, Huyện Gia Viễn", "Ninh Bình", "Danh lam thắng cảnh", "Di tích tâm linh/Du lịch", "https://i.imgur.com/B0jXp2g.jpg"],
            [20.2153, 105.9150, "Tam Cốc - Bích Động", "Xã Ninh Hải, Huyện Hoa Lư", "Ninh Bình", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/W2x9q3k.jpg"],
            [22.3386, 103.8522, "Sa Pa (Núi Fansipan)", "Thị xã Sa Pa", "Lào Cai", "Danh lam thắng cảnh", "Du lịch nghỉ dưỡng/Văn hóa", "https://i.imgur.com/9v4v94j.jpg"],
            [22.3278, 103.8394, "Bản Cát Cát", "Xã San Sả Hồ, Thị xã Sa Pa", "Lào Cai", "Danh lam thắng cảnh", "Du lịch văn hóa/Làng bản", "https://i.imgur.com/P0vD0J7.jpg"],
            [23.2750, 105.2833, "Cao nguyên đá Đồng Văn", "Huyện Đồng Văn", "Hà Giang", "Danh lam thắng cảnh", "Công viên địa chất toàn cầu", "https://i.imgur.com/5lG2o7b.jpg"],
            [23.3561, 105.3400, "Cột cờ Lũng Cú", "Xã Lũng Cú, Huyện Đồng Văn", "Hà Giang", "Danh lam thắng cảnh", "Di tích lịch sử/Danh thắng", "https://i.imgur.com/K5f46s9.jpg"],
            [22.8464, 106.6267, "Thác Bản Giốc", "Xã Đàm Thủy, Huyện Trùng Khánh", "Cao Bằng", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/zV8x65H.jpg"],
            [22.8550, 105.9000, "Khu di tích Pác Bó", "Xã Trường Hà, Huyện Hà Quảng", "Cao Bằng", "Danh lam thắng cảnh", "Di tích lịch sử", "https://i.imgur.com/1c7R8V8.jpg"],
            [22.3667, 105.7667, "Hồ Ba Bể", "Vườn Quốc gia Ba Bể, Huyện Ba Bể", "Bắc Kạn", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/2Y5R7f7.jpg"],
            [20.8000, 104.9000, "Cao nguyên Mộc Châu", "Huyện Mộc Châu", "Sơn La", "Danh lam thắng cảnh", "Du lịch nông nghiệp", "https://i.imgur.com/8Y4j8V9.jpg"],
            [21.5772, 103.7781, "Đèo Pha Đin", "Ranh giới giữa Sơn La và Điện Biên", "Sơn La/Điện Biên", "Danh lam thắng cảnh", "Danh lam thắng cảnh/Đèo", "https://i.imgur.com/mX7h6y8.jpg"],
            [21.3167, 103.0167, "Cánh đồng Mường Thanh", "Thành phố Điện Biên Phủ", "Điện Biên", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/z3c6E4y.jpg"],
            [21.3833, 103.0167, "Di tích lịch sử Điện Biên Phủ", "Thành phố Điện Biên Phủ", "Điện Biên", "Danh lam thắng cảnh", "Di tích lịch sử", "https://i.imgur.com/pY2E5S7.jpg"],
            [21.7833, 104.3000, "Ruộng bậc thang Mù Cang Chải", "Huyện Mù Cang Chải", "Yên Bái", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/b9i9k6o.jpg"],
            [22.1667, 105.0000, "Hồ Thác Bà", "Huyện Yên Bình, Lục Yên", "Yên Bái", "Danh lam thắng cảnh", "Hồ nhân tạo", "https://i.imgur.com/6U8Y18C.jpg"],
            [20.7833, 107.0500, "Đảo Cát Bà", "Huyện Cát Hải", "Hải Phòng", "Danh lam thắng cảnh", "Du lịch biển/Vườn Quốc gia", "https://i.imgur.com/C3fE43t.jpg"],
            [21.3667, 104.6000, "Núi Tà Xùa", "Huyện Bắc Yên", "Sơn La", "Danh lam thắng cảnh", "Danh lam thắng cảnh/Săn mây", "https://i.imgur.com/fL3h1f6.jpg"],
            [20.8167, 105.0500, "Mai Châu", "Huyện Mai Châu", "Hòa Bình", "Danh lam thắng cảnh", "Du lịch văn hóa/Làng bản", "https://i.imgur.com/mO2Xp3E.jpg"],
            [21.3961, 105.3956, "Đền Hùng", "Xã Hy Cương, Thành phố Việt Trì", "Phú Thọ", "Danh lam thắng cảnh", "Di tích lịch sử/Văn hóa", "https://i.imgur.com/4oW2S4Q.jpg"],
            [21.0500, 105.8167, "Hồ Tây", "Quận Tây Hồ", "Hà Nội", "Danh lam thắng cảnh", "Danh lam thắng cảnh", "https://i.imgur.com/5J3d4Z8.jpg"],
            [20.7333, 105.7833, "Chùa Hương", "Xã Hương Sơn, Huyện Mỹ Đức", "Hà Nội", "Danh lam thắng cảnh", "Quần thể di tích tâm linh", "https://i.imgur.com/s4sI3FN.jpg"],
            [21.0253, 105.8475, "Nhà tù Hỏa Lò", "Số 1 Hỏa Lò, Quận Hoàn Kiếm", "Hà Nội", "Danh lam thắng cảnh", "Di tích lịch sử", "https://i.imgur.com/DMMxHBi.jpg"],
            [20.6000, 105.9500, "Chùa Tam Chúc", "Thị trấn Ba Sao, Huyện Kim Bảng", "Hà Nam", "Danh lam thắng cảnh", "Di tích tâm linh", "https://i.imgur.com/g8S226J.jpg"],
            [20.8875, 107.0139, "Hang Sửng Sốt", "Đảo Bồ Hòn, Vịnh Hạ Long", "Quảng Ninh", "Danh lam thắng cảnh", "Hang động", "https://i.imgur.com/rS2a4z0.jpg"],
            [21.1167, 105.5333, "Làng cổ Đường Lâm", "Thị xã Sơn Tây", "Hà Nội", "Danh lam thắng cảnh", "Di tích lịch sử/Văn hóa", "https://i.imgur.com/i9Td2pq.jpg"],
            [21.0441, 105.8436, "Phở cuốn Hương Mai", "Số 25 Ngũ Xã, Quận Ba Đình", "Hà Nội", "Quán ăn", "Quán ăn", "https://i.imgur.com/w8qHJKn.jpg"],
            [21.0315, 105.8466, "Phở Bát Đàn", "Số 49 Phố Bát Đàn, Quận Hoàn Kiếm", "Hà Nội", "Quán ăn", "Quán ăn", "https://i.imgur.com/Bf1oT5Q.jpg"],
            [21.0334, 105.8492, "Chả cá Lã Vọng", "Số 14 Phố Chả Cá, Quận Hoàn Kiếm", "Hà Nội", "Quán ăn", "Quán ăn đặc sản", "https://i.imgur.com/s4sI3FN.jpg"],
            [21.0321, 105.8481, "Bún chả Hàng Quạt", "Số 74 Phố Hàng Quạt, Quận Hoàn Kiếm", "Hà Nội", "Quán ăn", "Quán ăn", "https://i.imgur.com/DMMxHBi.jpg"],
            [21.0118, 105.8507, "Bánh cuốn Bà Hoành", "Số 66 Phố Tô Hiến Thành, Quận Hai Bà Trưng", "Hà Nội", "Quán ăn", "Quán ăn", "https://i.imgur.com/g8S226J.jpg"],
            [21.0119, 105.8572, "Phở Thìn Lò Đúc", "Số 13 Phố Lò Đúc, Quận Hai Bà Trưng", "Hà Nội", "Quán ăn", "Quán ăn", "https://i.imgur.com/rS2a4z0.jpg"],
            [21.0312, 105.8545, "Cà phê Giảng", "Số 39 Phố Nguyễn Hữu Huân", "Hà Nội", "Quán cà phê", "Quán cà phê", "https://i.imgur.com/Y1N6uG2.jpg"],
            // ... (Dữ liệu đầy đủ của bạn vẫn ở đây)
        ];

        // --- 15 ĐỊA ĐIỂM NỔI BẬT CHO CAROUSEL ---
        const featuredLocations = [
            // MIỀN BẮC
            { name: "Vịnh Hạ Long", address: "Thành phố Hạ Long, Quảng Ninh", tag: "Kỳ quan thiên nhiên", description: "Khám phá hàng ngàn hòn đảo đá vôi kỳ vĩ và làn nước xanh như ngọc tại di sản thiên nhiên thế giới được UNESCO công nhận.", imageUrl: "https://i.imgur.com/K5f46s9.jpg" },
            { name: "Phố cổ Hà Nội", address: "Quận Hoàn Kiếm, Hà Nội", tag: "Văn hóa & Ẩm thực", description: "Lạc vào những con phố nghề san sát, thưởng thức ẩm thực đường phố đặc sắc và cảm nhận nhịp sống ngàn năm văn hiến.", imageUrl: "https://i.imgur.com/g8S226J.jpg" },
            { name: "Sa Pa (Núi Fansipan)", address: "Thị xã Sa Pa, Lào Cai", tag: "Thiên nhiên & Trải nghiệm", description: "Chinh phục 'Nóc nhà Đông Dương' hùng vĩ và chiêm ngưỡng những thửa ruộng bậc thang tuyệt đẹp giữa mây ngàn.", imageUrl: "https://i.imgur.com/9v4v94j.jpg" },
            { name: "Quần thể danh thắng Tràng An", address: "Huyện Hoa Lư, Ninh Bình", tag: "Di sản UNESCO", description: "Ngồi thuyền xuôi theo dòng nước, len lỏi qua các hang động và núi đá vôi để khám phá vẻ đẹp của 'Hạ Long trên cạn'.", imageUrl: "https://i.imgur.com/1Oq2E9z.jpg" },
            { name: "Cà phê Giảng", address: "Số 39 Nguyễn Hữu Huân, Hà Nội", tag: "Đặc sản Hà Nội", description: "Thưởng thức ly cà phê trứng trứ danh, một sáng tạo độc đáo với lớp kem trứng béo ngậy hòa quyện cùng vị cà phê đắng dịu.", imageUrl: "https://i.imgur.com/Y1N6uG2.jpg" },
            // MIỀN TRUNG
            { name: "Phố cổ Hội An", address: "TP. Hội An, Quảng Nam", tag: "Di sản thế giới", description: "Dạo bước trên những con đường lát đá cổ kính, ngắm nhìn những ngôi nhà màu vàng và thả đèn hoa đăng trên sông Hoài thơ mộng.", imageUrl: "https://i.imgur.com/cDeFgHj.jpg" },
            { name: "Đại Nội Huế", address: "TP. Huế, Thừa Thiên Huế", tag: "Lịch sử & Kiến trúc", description: "Quay ngược thời gian trở về triều Nguyễn, khám phá kinh thành, cung điện và đền đài mang đậm dấu ấn lịch sử vàng son.", imageUrl: "https://i.imgur.com/FgHjKlM.jpg" },
            { name: "Bà Nà Hills (Cầu Vàng)", address: "Huyện Hòa Vang, Đà Nẵng", tag: "Kiến trúc độc đáo", description: "Dạo bước trên Cầu Vàng trứ danh được nâng đỡ bởi đôi bàn tay khổng lồ và tận hưởng không khí trong lành, mát mẻ.", imageUrl: "https://i.imgur.com/VwXyZaB.jpg" },
            { name: "Ghềnh Đá Đĩa", address: "Huyện Tuy An, Phú Yên", tag: "Địa chất kỳ thú", description: "Chiêm ngưỡng kiệt tác của thiên nhiên với hàng chục nghìn cột đá bazan hình lục giác xếp chồng lên nhau như một tổ ong khổng lồ.", imageUrl: "https://i.imgur.com/nOpQrSt.jpg"},
            { name: "Động Phong Nha", address: "Huyện Bố Trạch, Quảng Bình", tag: "Khám phá hang động", description: "Du thuyền trên sông Son để tiến vào hang động, chiêm ngưỡng hệ thống thạch nhũ tráng lệ và kỳ ảo bậc nhất thế giới.", imageUrl: "https://i.imgur.com/OpQrStU.jpg"},
            // MIỀN NAM
            { name: "Chợ nổi Cái Răng", address: "Q. Ninh Kiều, Cần Thơ", tag: "Văn hóa Sông nước", description: "Trải nghiệm nét văn hóa độc đáo của miền Tây khi ngồi thuyền len lỏi giữa hàng trăm ghe thuyền mua bán tấp nập trên sông.", imageUrl: "https://i.imgur.com/8Y4j8V9.jpg" },
            { name: "Bãi Sao, Phú Quốc", address: "TP. Phú Quốc, Kiên Giang", tag: "Thiên đường nghỉ dưỡng", description: "Thư giãn trên bãi cát trắng mịn như kem, đắm mình trong làn nước biển trong xanh và tận hưởng không gian yên bình.", imageUrl: "https://i.imgur.com/b9i9k6o.jpg"},
            { name: "Dinh Độc Lập", address: "Quận 1, TP. Hồ Chí Minh", tag: "Chứng nhân Lịch sử", description: "Tham quan công trình kiến trúc ghi dấu ấn sâu đậm trong lịch sử Việt Nam, nơi diễn ra sự kiện thống nhất đất nước.", imageUrl: "https://i.imgur.com/0vUnV5G.jpg"},
            { name: "Địa đạo Củ Chi", address: "Huyện Củ Chi, TP. Hồ Chí Minh", tag: "Di tích Lịch sử", description: "Khám phá hệ thống phòng thủ dưới lòng đất, một minh chứng cho sự kiên cường và sáng tạo của quân dân Việt Nam.", imageUrl: "https://i.imgur.com/g8S226J.jpg" },
            { name: "Bánh mì Huỳnh Hoa", address: "Quận 1, TP. Hồ Chí Minh", tag: "Ẩm thực đường phố", description: "Thưởng thức ổ bánh mì trứ danh Sài Gòn, nổi tiếng với phần nhân đầy đặn, pate béo ngậy và hương vị đậm đà khó quên.", imageUrl: "https://i.imgur.com/C3fE43t.jpg"}
        ];
        
        // --- SCRIPT XỬ LÝ CHÍNH ---
        const locations = rawLocations.map(([lat, lng, name, address, city, mainCategory, detailedType, imageUrl], index) => ({
            id: index, lat, lng, name, address, city, mainCategory, detailedType, imageUrl
        }));

        let map, allMarkers = [], markerLayerGroup;

        function initializeLeafletMap() {
            map = L.map('leaflet-map').setView([16.0, 107.5], 5.5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>', maxZoom: 18
            }).addTo(map);
            markerLayerGroup = L.layerGroup().addTo(map);
            createAllMarkers();
            renderFilteredMarkers(locations); // **KHÔI PHỤC HIỂN THỊ TẤT CẢ ĐIỂM BAN ĐẦU**
            populateCityFilter();
            populateCategoryFilter();
        }
        
        function createAllMarkers() {
            allMarkers = locations.map(loc => {
                const marker = L.circleMarker([loc.lat, loc.lng], {
                    radius: 8,
                    fillColor: "#4f46e5", color: "#fff", weight: 2, opacity: 1, fillOpacity: 0.8
                });
                const popupContent = `<div class="p-1 font-inter"><p class="font-bold text-base text-indigo-700">${loc.name}</p><p class="text-xs text-gray-600">${loc.address}</p><p class="text-xs mt-1 text-gray-500 italic">${loc.detailedType}</p></div>`;
                marker.bindPopup(popupContent, { maxWidth: 300 });
                marker.locationData = loc;
                return marker;
            });
        }

        function populateCityFilter() {
            const filterSelect = document.getElementById('city-filter');
            const uniqueCities = [...new Set(locations.map(loc => loc.city))].sort();
            uniqueCities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                filterSelect.appendChild(option);
            });
        }

        function populateCategoryFilter() {
            const filterSelect = document.getElementById('category-filter');
            const uniqueCategories = [...new Set(locations.map(loc => loc.mainCategory))].sort();
            uniqueCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filterSelect.appendChild(option);
            });
        }
        
        function filterAndRender() {
            const nameSearchTerm = document.getElementById('name-search-input').value.toLowerCase().trim();
            const selectedCity = document.getElementById('city-filter').value;
            const selectedCategory = document.getElementById('category-filter').value;
            
            let filteredLocations = locations.filter(loc => {
                const matchesName = !nameSearchTerm || loc.name.toLowerCase().includes(nameSearchTerm) || loc.address.toLowerCase().includes(nameSearchTerm);
                const matchesCity = !selectedCity || loc.city === selectedCity;
                const matchesCategory = !selectedCategory || loc.mainCategory === selectedCategory;
                return matchesName && matchesCity && matchesCategory;
            });
            
            renderFilteredMarkers(filteredLocations);
        }

        function renderFilteredMarkers(locationsToShow) {
            markerLayerGroup.clearLayers();
            locationsToShow.forEach(loc => {
                const marker = allMarkers.find(m => m.locationData.id === loc.id);
                if (marker) marker.addTo(markerLayerGroup);
            });
            
            // Chỉ zoom vào khu vực được lọc nếu người dùng thực sự lọc
            if (locationsToShow.length > 0 && locationsToShow.length < locations.length) {
                const bounds = L.latLngBounds(locationsToShow.map(loc => [loc.lat, loc.lng]));
                map.fitBounds(bounds, {padding: [50, 50], maxZoom: 12});
            } else if (locationsToShow.length === 0) {
                 // Không làm gì để giữ nguyên view
            }
             else {
                map.setView([16.0, 107.5], 5.5); // Reset view khi không lọc
            }
        }
        
        // --- Alpine.js Carousel Controller ---
        function carousel() {
            return {
                currentIndex: 0,
                itemsPerScreen: 3,
                interval: null,

                init() {
                    this.updateItemsPerScreen();
                    window.addEventListener('resize', () => this.updateItemsPerScreen());
                    this.renderFeaturedItems();
                    this.startAutoplay();
                },

                updateItemsPerScreen() {
                    this.itemsPerScreen = window.innerWidth < 768 ? 1 : 3;
                },

                renderFeaturedItems() {
                    const container = this.$refs.container;
                    container.innerHTML = featuredLocations.map(loc => `
                        <div class="flex-shrink-0 w-full md:w-1/3 snap-start p-3">
                            <div class="bg-white rounded-lg shadow-lg overflow-hidden h-full flex flex-col">
                                <img src="${loc.imageUrl}" alt="${loc.name}" class="w-full h-48 object-cover">
                                <div class="p-4 flex flex-col flex-grow">
                                    <span class="text-xs font-semibold text-indigo-600 bg-indigo-100 px-2 py-1 rounded-full self-start mb-2">${loc.tag}</span>
                                    <h3 class="font-bold text-lg text-gray-800">${loc.name}</h3>
                                    <p class="text-sm text-gray-500 mb-3">${loc.address}</p>
                                    <p class="text-sm text-gray-600 flex-grow">${loc.description}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                },

                scrollToCurrent() {
                    const container = this.$refs.container;
                    const itemWidth = container.querySelector('div').clientWidth;
                    container.scrollTo({ left: this.currentIndex * itemWidth, behavior: 'smooth' });
                },

                next() {
                    this.currentIndex = (this.currentIndex >= featuredLocations.length - this.itemsPerScreen) ? 0 : this.currentIndex + 1;
                    this.scrollToCurrent();
                    this.resetAutoplay();
                },

                prev() {
                    this.currentIndex = (this.currentIndex <= 0) ? featuredLocations.length - this.itemsPerScreen : this.currentIndex - 1;
                    this.scrollToCurrent();
                    this.resetAutoplay();
                },

                startAutoplay() {
                    this.interval = setInterval(() => { this.next(); }, 7000);
                },

                resetAutoplay() {
                    clearInterval(this.interval);
                    this.startAutoplay();
                }
            }
        }

        function initializeApp() {
            initializeLeafletMap();
            const nameInput = document.getElementById('name-search-input');
            const cityFilter = document.getElementById('city-filter');
            const categoryFilter = document.getElementById('category-filter');
            
            let searchTimeout;
            const handleFilterChange = () => { 
                clearTimeout(searchTimeout); 
                searchTimeout = setTimeout(filterAndRender, 300); 
            };
            
            nameInput.addEventListener('input', handleFilterChange);
            cityFilter.addEventListener('change', handleFilterChange);
            categoryFilter.addEventListener('change', handleFilterChange);
        }

        window.onload = initializeApp;
    </script>
</body>
</html>
