<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam Travel Treasury - Quick Summary</title>
    <!-- Load Tailwind CSS for modern and responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a nicer look */
        .list-container::-webkit-scrollbar {
            width: 6px;
        }
        .list-container::-webkit-scrollbar-thumb {
            background-color: #a8a29e;
            border-radius: 3px;
        }
        .list-container::-webkit-scrollbar-track {
            background-color: #f5f5f5;
        }

        /* Define style for the preview card (Tooltip) */
        #preview-card {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px; /* Fixed width */
            z-index: 100;
            pointer-events: none; /* Do not block mouse clicks on elements below */
            transition: opacity 0.3s ease;
        }

        @media (max-width: 768px) {
            #preview-card {
                /* Completely hide on mobile devices to prevent screen obstruction */
                display: none !important; 
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-2">
                Vietnam Travel Treasury
            </h1>
            <p class="text-gray-600 text-lg">Hover over a location to see a quick summary.</p>
        </header>

        <!-- Search bar and filter -->
        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg mb-8 space-y-4 md:flex md:space-y-0 md:space-x-4">
            <!-- Search Input -->
            <input 
                type="text" 
                id="search-input" 
                placeholder="Search by location name..."
                class="w-full md:flex-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
            >
            <!-- City Filter -->
            <select 
                id="city-filter" 
                class="w-full md:w-1/3 p-3 border border-gray-300 rounded-lg bg-white appearance-none focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                onchange="filterLocations()"
            >
                <option value="">-- Filter by City/Province --</option>
            </select>
        </div>

        <!-- Container for the list of locations -->
        <div 
            id="location-list" 
            class="list-container grid gap-4 md:grid-cols-2 lg:grid-cols-3 max-h-[70vh] overflow-y-auto pr-2"
        >
            <!-- Locations will be rendered here -->
            <p id="loading-message" class="col-span-full text-center text-gray-500 p-8">Loading data...</p>
        </div>

        <footer class="mt-10 text-center text-gray-500 text-sm border-t pt-4">
            &copy; 2025 Tourism Data. Summarized data provided by Gemini API & Google Search.
        </footer>
    </div>
    
    <!-- PREVIEW CARD -->
    <div id="preview-card" class="hidden bg-white rounded-xl shadow-2xl p-4 border-t-4 border-indigo-500 transition-all duration-300">
        <div class="text-sm font-bold text-indigo-600 mb-2" id="preview-title"></div>
        <div id="preview-content" class="text-gray-700 text-sm leading-snug"></div>
        
        <div id="preview-loading" class="text-center py-4 hidden">
            <svg class="animate-spin h-5 w-5 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-1 text-sm text-gray-500">Searching for information...</p>
        </div>
    </div>

    <script>
        // Initial Data (Names and addresses remain the same for searching)
        const rawLocations = [
            {"name": "Old Quarter", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Ta Hien Street", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Tong Duy Tan Street", "address": "Hoan Kiem District, Hanoi"},
            {"name": "St. Joseph's Cathedral", "address": "40 Nha Chung Street, Hoan Kiem District, Hanoi"},
            {"name": "Train Street, Tran Phu", "address": "Ba Dinh District, Hanoi"},
            {"name": "Ho Chi Minh Mausoleum", "address": "2 Hung Vuong Street, Ba Dinh District, Hanoi"},
            {"name": "Hoan Kiem Lake", "address": "Hoan Kiem District, Hanoi"},
            {"name": "Long Bien Bridge", "address": "Connecting Long Bien and Ba Dinh Districts, Hanoi"},
            {"name": "One Pillar Pagoda", "address": "Dien Bien Ward, Ba Dinh District, Hanoi"},
            {"name": "Temple of Literature", "address": "58 Quoc Tu Giam Street, Dong Da District, Hanoi"},
            
            {"name": "Notre-Dame Cathedral Basilica of Saigon", "address": "1 Cong xa Paris, District 1, Ho Chi Minh City"},
            {"name": "Saigon Central Post Office", "address": "2 Cong xa Paris, District 1, Ho Chi Minh City"},
            {"name": "Ben Thanh Market", "address": "45 Le Loi, District 1, Ho Chi Minh City"},
            {"name": "Bitexco Financial Tower", "address": "2 Hai Trieu, District 1, Ho Chi Minh City"},
            {"name": "Tan Dinh Church (Pink Church)", "address": "289 Hai Ba Trung, District 1, Ho Chi Minh City"},
            {"name": "Cafe Apartment", "address": "42-44 Nguyen Hue Street, District 1, Ho Chi Minh City"},
            {"name": "Suoi Tien Theme Park", "address": "120 Xa Lo Ha Noi, District 9, Ho Chi Minh City"},
            {"name": "Nguyen Van Binh Book Street", "address": "9 Nguyen Van Binh, District 1, Ho Chi Minh City"},
            {"name": "23/9 Park", "address": "District 1, Ho Chi Minh City"},
            {"name": "Bui Vien Street", "address": "District 1, Ho Chi Minh City"},
            
            {"name": "Hoi An Ancient Town", "address": "Minh An Ward, Hoi An City, Quang Nam"},
            {"name": "Japanese Covered Bridge", "address": "Hoi An Ancient Town, Quang Nam"},
            {"name": "Cau Pagoda", "address": "Hoi An Ancient Town, Quang Nam"},
            {"name": "Cam Thanh Coconut Forest", "address": "Cam Thanh Commune, Hoi An, Quang Nam"},
            {"name": "An Bang Beach", "address": "Cam An Commune, Hoi An, Quang Nam"},
            {"name": "Thanh Ha Pottery Village", "address": "Thanh Ha Ward, Hoi An, Quang Nam"},
            {"name": "Hoi An History Museum", "address": "Hoi An Ancient Town, Quang Nam"},
            
            {"name": "Golden Bridge, Ba Na Hills", "address": "An Son Hamlet, Hoa Ninh Commune, Hoa Vang District, Da Nang"},
            {"name": "Dragon Bridge", "address": "Hai Chau District, Da Nang"},
            {"name": "My Khe Beach", "address": "Son Tra District, Da Nang"},
            {"name": "Marble Mountains", "address": "Ngu Hanh Son District, Da Nang"},
            {"name": "Cham Museum", "address": "2 Phan Chau Trinh, Hai Chau District, Da Nang"},
            {"name": "Han River Bridge", "address": "Hai Chau District, Da Nang"},
            
            {"name": "Ha Long Bay", "address": "Ha Long City, Quang Ninh"},
            {"name": "Bai Chay Bridge", "address": "Ha Long City, Quang Ninh"},
            {"name": "Bai Chay Resort", "address": "Ha Long City, Quang Ninh"},
            
            {"name": "Rong May Glass Bridge", "address": "Sapa, Lao Cai"},
            {"name": "Ham Rong Mountain", "address": "Sapa Town, Lao Cai"},
            {"name": "Silver Waterfall", "address": "Sapa, Lao Cai"},
            {"name": "Muong Hoa Terraces", "address": "Sapa, Lao Cai"},
            {"name": "Sapa Market", "address": "Sapa Town, Lao Cai"},
            
            {"name": "Trang An Ecotourism Complex", "address": "Gia Vien District, Ninh Binh"},
            {"name": "Tam Coc - Bich Dong", "address": "Ninh Hai Commune, Ninh Binh"},
            {"name": "Hang Mua", "address": "Ninh Hai Commune, Ninh Binh"},
            {"name": "Bai Dinh Pagoda", "address": "Gia Vien District, Ninh Binh"},
            {"name": "Phat Diem Stone Cathedral", "address": "Kim Son District, Ninh Binh"},
            
            {"name": "Bai Sao Beach", "address": "Phu Quoc Island, Kien Giang"},
            {"name": "Vinpearl Land Phu Quoc", "address": "Ganh Dau, Phu Quoc, Kien Giang"},
            {"name": "Phu Quoc Fish Sauce Factory", "address": "An Thoi, Phu Quoc, Kien Giang"},
            {"name": "Dinh Cau Night Market", "address": "Duong Dong Town, Phu Quoc, Kien Giang"},
            
            {"name": "Xuan Huong Lake", "address": "City Center, Da Lat, Lam Dong"},
            {"name": "Valley of Love", "address": "Ward 8, Da Lat, Lam Dong"},
            {"name": "Domain De Marie Church", "address": "1 Tran Phu Street, Da Lat"},
            {"name": "Tuyen Lam Lake", "address": "Ward 3, Da Lat"},
            {"name": "Pongour Waterfall", "address": "Duc Trong District, Lam Dong"},
            {"name": "Crazy House", "address": "3 Huynh Thuc Khang, Da Lat"},
            
            {"name": "Cu Lao Cham", "address": "Hoi An, Quang Nam"},
            {"name": "Nguyen Hue Walking Street", "address": "District 1, Ho Chi Minh City"},
            {"name": "Duong Lam Ancient Village", "address": "Son Tay Town, Hanoi"},
            {"name": "Hung Kings Temple", "address": "Phu Tho"},
            {"name": "West Lake", "address": "Tay Ho District, Hanoi"},
            {"name": "Suoi Ca Than Hot Spring", "address": "Cẩm Lương, Quang Nam"},
            {"name": "Bai Da Trung", "address": "Quang Binh"},
            {"name": "Cuc Phuong National Park", "address": "Ninh Binh"},
            {"name": "Ly Son Island", "address": "Quang Ngai"},
            {"name": "Hai Van Pass", "address": "Border of Hue and Da Nang"},
            {"name": "Quang Tri Citadel", "address": "Quang Tri"},
            {"name": "Thien Mu Pagoda", "address": "Hue"},
            {"name": "My Khe Beach", "address": "Da Nang"},
            {"name": "Phu My Hung Urban Area", "address": "District 7, Ho Chi Minh City"},
            {"name": "An Thoi Diving Site", "address": "Phu Quoc, Kien Giang"},
            {"name": "Tan Trao Banyan Tree", "address": "Tuyen Quang"},
            {"name": "Can Gio Mangrove Forest", "address": "Ho Chi Minh City"},
            {"name": "Mui Ne Beach", "address": "Binh Thuan"},
            {"name": "Nguyen Hue Flower Street", "address": "District 1, Ho Chi Minh City"},
            {"name": "Vietnam Museum of Ethnology", "address": "Nguyen Văn Huyen, Cau Giay, Hanoi"},
            {"name": "Dong Xuan Market", "address": "Hoan Kiem, Hanoi"},
            {"name": "Tu Duc Tomb", "address": "Hue"},
            {"name": "Poshanu Cham Towers", "address": "Ninh Thuan"},
            {"name": "Hue Ancient Town", "address": "Hue"},
            {"name": "Phat Diem Stone Church", "address": "Kim Son, Ninh Binh"},
            {"name": "Ba Vi National Park", "address": "Ba Vi, Hanoi"},
            {"name": "Thap Ba Hot Spring", "address": "Nha Trang, Khanh Hoa"},
            {"name": "Ba Den Mountain", "address": "Tay Ninh"},
            {"name": "Ancient Village Communal House", "address": "Bac Ninh"},
            {"name": "Dai Nam Tourism Complex", "address": "Binh Duong"},
            {"name": "Suoi Mo Waterfall", "address": "Dong Nai"},
            {"name": "Long Bien Bridge", "address": "Hanoi"},
            {"name": "Cua Lo Beach", "address": "Nghe An"},
            {"name": "Thien Son-Hoan Nga Ecotourism", "address": "Ba Vi, Hanoi"},
            {"name": "Nui Coc Lake Tourist Area", "address": "Thai Nguyen"},
            {"name": "Hung Kings Temple", "address": "Phu Tho"},
            {"name": "Cai Rang Floating Market", "address": "Can Tho"},
            {"name": "Cat Ba Island", "address": "Hai Phong"},
            {"name": "Hai Phong Cathedral", "address": "Hai Phong"},
            {"name": "Quan Lan Island", "address": "Quang Ninh"},
            {"name": "Cua Lo Fishing Port", "address": "Nghe An"},
            {"name": "Luy Lau Ancient Citadel", "address": "Bac Ninh"},
            {"name": "Ho Tram Beach", "address": "Ba Ria - Vung Tau"},
            {"name": "Ba Dinh Square", "address": "Hanoi"}
        ];

        // --- JAVASCRIPT & GEMINI API LOGIC AREA ---

        const locationListElement = document.getElementById('location-list');
        const searchInputElement = document.getElementById('search-input');
        const cityFilterElement = document.getElementById('city-filter');
        const previewCard = document.getElementById('preview-card');
        const previewTitle = document.getElementById('preview-title');
        const previewContent = document.getElementById('preview-content');
        const previewLoading = document.getElementById('preview-loading');

        // Cache to store API results, avoiding repeated calls
        const previewCache = {};
        
        // API Configuration
        const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";
        const GEMINI_API_KEY = "";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
        
        // --- INITIAL DATA PROCESSING LOGIC ---

        function extractCity(address) {
            if (!address) return "Other";
            if (address.includes("Ho Chi Minh City") || address.includes("HCM")) return "Ho Chi Minh City";
            if (address.includes("Hanoi") || address.includes("Hà Nội")) return "Hanoi";
            if (address.includes("Quang Nam")) return "Quang Nam";
            if (address.includes("Da Nang") || address.includes("Đà Nẵng")) return "Da Nang";
            if (address.includes("Quang Ninh")) return "Quang Ninh (Ha Long)";
            if (address.includes("Lao Cai") || address.includes("Lào Cai")) return "Lao Cai (Sapa)";
            if (address.includes("Ninh Binh") || address.includes("Ninh Bình")) return "Ninh Binh";
            if (address.includes("Kien Giang") || address.includes("Kiên Giang")) return "Kien Giang (Phu Quoc)";
            if (address.includes("Lam Dong") || address.includes("Lâm Đồng") || address.includes("Da Lat")) return "Lam Dong (Da Lat)";
            if (address.includes("Hue") || address.includes("Huế")) return "Thua Thien Hue";
            const parts = address.split(',').map(p => p.trim());
            return parts[parts.length - 1] || "Other";
        }

        const locations = rawLocations.map(loc => ({
            ...loc,
            city: extractCity(loc.address)
        }));

        function populateCityFilter() {
            const cities = new Set(locations.map(loc => loc.city).filter(c => c));
            const priorityCities = ["Hanoi", "Ho Chi Minh City", "Quang Nam", "Da Nang", "Lam Dong (Da Lat)", "Kien Giang (Phu Quoc)", "Quang Ninh (Ha Long)", "Ninh Binh", "Thua Thien Hue"];
            const sortedCities = Array.from(cities).sort((a, b) => {
                const aIndex = priorityCities.indexOf(a);
                const bIndex = priorityCities.indexOf(b);
                if (aIndex === -1 && bIndex === -1) return a.localeCompare(b);
                if (aIndex !== -1 && bIndex === -1) return -1;
                if (aIndex === -1 && bIndex !== -1) return 1;
                return aIndex - bIndex;
            });
            
            sortedCities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilterElement.appendChild(option);
            });
        }

        // --- PREVIEW & API CALL LOGIC ---
        
        // Function to fetch API with exponential backoff
        async function retryFetch(url, options, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        // Retry after 2^i seconds
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`API returned status ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    console.error("Fetch failed, retrying...", error); 
                }
            }
        }


        // Main function to call Gemini API for Google Search summary
        async function fetchGoogleSearchPreview(locationName) {
            // 1. Check Cache
            if (previewCache[locationName]) {
                return previewCache[locationName];
            }

            // 2. Prompt Configuration (Updated to request English output, strictly 5-10 lines)
            const systemPrompt = "Act as a professional travel guide. Provide a concise, single-paragraph summary of this tourist location in English, strictly limited to 5-10 lines. Focus on key highlights, history, or recent travel experiences. Do not mention phrases like 'based on search' or 'I found'.";
            const userQuery = `Find the latest information and briefly summarize ${locationName} in Vietnam. Provide the output in English, ensuring it is no more than 10 lines long.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            // 3. API Call
            try {
                const response = await retryFetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    
                    const data = { text, error: null };
                    previewCache[locationName] = data; // Save to cache
                    return data;

                } else {
                    const errorMsg = "Could not generate summary. Please try again.";
                    previewCache[locationName] = { text: errorMsg, error: true };
                    return previewCache[locationName];
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                const errorMsg = "Connection error. Please check the console or try again.";
                previewCache[locationName] = { text: errorMsg, error: true };
                return previewCache[locationName];
            }
        }

        // Function to update the preview card
        function updatePreviewCard(locationName, result) {
            previewTitle.textContent = locationName;
            
            if (result.error) {
                 previewContent.innerHTML = `<p class="text-red-500">Error: ${result.text}</p>`;
            } else {
                 // Replace newlines with <br> for better formatting in the preview box
                 previewContent.innerHTML = result.text.replace(/\n/g, '<br>');
            }
            
            previewLoading.classList.add('hidden');
            previewContent.classList.remove('hidden');
        }

        // Function to handle mouse enter event
        async function handleMouseEnter(event) {
            // Only process on large screens
            if (window.innerWidth <= 768) return; 

            const target = event.currentTarget;
            const locationName = target.getAttribute('data-name');

            // 1. Display and position the preview card
            const rect = target.getBoundingClientRect();
            
            let cardX = rect.right + 20; 
            let cardY = rect.top + window.scrollY; 
            
            // Shift left if it overflows right
            if (cardX + 320 > window.innerWidth - 20) {
                cardX = rect.left - 320 - 20;
            }
            
            // Ensure it doesn't overflow left (if shifted left)
            if (cardX < 20) {
                 cardX = rect.right + 20; 
            }

            previewCard.style.left = `${cardX}px`;
            previewCard.style.top = `${cardY}px`;
            previewCard.classList.remove('hidden');
            previewCard.style.opacity = '1';

            // 2. Show loading state
            previewTitle.textContent = locationName;
            previewLoading.classList.remove('hidden');
            previewContent.classList.add('hidden');
            
            // 3. Load data
            try {
                const result = await fetchGoogleSearchPreview(locationName);
                if (locationListElement.contains(target)) { // Only update if the mouse is still hovering
                    updatePreviewCard(locationName, result);
                }
            } catch(e) {
                 if (locationListElement.contains(target)) {
                    updatePreviewCard(locationName, { text: "An error occurred while loading data.", error: true });
                }
            }
        }

        // Function to handle mouse leave event
        function handleMouseLeave() {
            previewCard.classList.add('hidden');
            previewCard.style.opacity = '0';
        }

        // --- RENDER & FILTER LOGIC (Updated to include mouse events) ---

        function renderLocations(filteredList) {
            locationListElement.innerHTML = '';
            
            if (filteredList.length === 0) {
                locationListElement.innerHTML = '<p class="col-span-full text-center text-xl text-red-500 font-medium p-10 bg-yellow-50 rounded-xl shadow-inner">No locations found matching the search/filter criteria.</p>';
                return;
            }

            filteredList.forEach(loc => {
                const item = document.createElement('div');
                item.className = 'loc-card bg-white p-4 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] border border-gray-100 cursor-pointer';
                item.setAttribute('data-name', loc.name);
                
                // Attach mouse events
                item.addEventListener('mouseenter', handleMouseEnter);
                item.addEventListener('mouseleave', handleMouseLeave);

                const icon = loc.city.includes("Hanoi") || loc.city.includes("Hue") ? '🏛️' : 
                             loc.city.includes("Ho Chi Minh City") ? '🏙️' : 
                             loc.city.includes("Da Nang") || loc.city.includes("Quang Nam") ? '⛱️' :
                             loc.city.includes("Phu Quoc") ? '🏝️' :
                             loc.city.includes("Da Lat") ? '⛰️' : '🇻🇳';

                item.innerHTML = `
                    <div class="flex items-center space-x-3 mb-2">
                        <span class="text-2xl">${icon}</span>
                        <h2 class="text-lg font-semibold text-indigo-600 leading-tight">${loc.name}</h2>
                    </div>
                    <p class="text-xs font-medium text-gray-500 bg-indigo-50 inline-block px-2 py-0.5 rounded-full mb-2">
                        ${loc.city}
                    </p>
                    <p class="text-sm text-gray-700 mt-1">
                        <span class="font-medium text-gray-500">Address:</span> ${loc.address}
                    </p>
                `;
                locationListElement.appendChild(item);
            });
        }

        function filterLocations() {
            const searchTerm = searchInputElement.value.toLowerCase().trim();
            const selectedCity = cityFilterElement.value;

            const filtered = locations.filter(loc => {
                const matchesSearch = loc.name.toLowerCase().includes(searchTerm) || 
                                      loc.address.toLowerCase().includes(searchTerm);
                
                const matchesCity = !selectedCity || loc.city === selectedCity;

                return matchesSearch && matchesCity;
            });

            renderLocations(filtered);
        }

        // --- INITIALIZATION ---

        searchInputElement.addEventListener('input', filterLocations);

        window.onload = () => {
            document.getElementById('loading-message').style.display = 'none'; 
            populateCityFilter();
            renderLocations(locations);
        };
    </script>
</body>
</html>
