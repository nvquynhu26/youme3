<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam Check-in Map Treasury</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/SVRQLyT37WHaWfG08=" crossorigin=""/>
    <!-- Load Leaflet Marker Cluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <!-- FIX L·ªñI 1: CHUY·ªÇN SCRIPT TH∆Ø VI·ªÜN LEAFLET L√äN ƒê√ÇY ƒê·ªÇ ƒê·∫¢M B·∫¢O CH√öNG T·∫¢I TR∆Ø·ªöC CODE APP -->
    <!-- Load Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20n6n+ByMhPIeZnhL6oYJbL1P5S3V3sB3t1Q2v5G5+0=" crossorigin=""></script>
    <!-- Load Leaflet Marker Cluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- K·∫æT TH√öC PH·∫¶N FIX L·ªñI T·∫¢I TH∆Ø VI·ªÜN -->


    <style>
        /* Define style for the preview card (Tooltip) */
        #preview-card {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px; /* Fixed width */
            z-index: 100;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        /* Map specific styles: TƒÉng chi·ªÅu cao l√™n 70% viewport height */
        #vietnam-map {
            height: 70vh; 
            width: 100%;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            margin-bottom: 2rem;
            z-index: 1;
        }

        /* Styles cho danh s√°ch cu·ªôn ngang (Carousel/Slider) */
        .horizontal-scroll-list {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 1rem;
        }
        
        .horizontal-scroll-list > div {
            flex: 0 0 auto; /* ƒê·∫£m b·∫£o c√°c item kh√¥ng co l·∫°i */
            width: 280px; /* Chi·ªÅu r·ªông c·ªë ƒë·ªãnh c·ªßa card */
            scroll-snap-align: start;
            margin-right: 1rem;
        }

        /* ·∫®n scrollbar m·∫∑c ƒë·ªãnh nh∆∞ng gi·ªØ l·∫°i kh·∫£ nƒÉng cu·ªôn */
        .horizontal-scroll-list::-webkit-scrollbar {
            height: 6px;
        }

        .horizontal-scroll-list::-webkit-scrollbar-thumb {
            background-color: #93c5fd; /* blue-300 */
            border-radius: 3px;
        }
        
        /* ·∫®n preview card tr√™n mobile */
        @media (max-width: 768px) {
            #preview-card { display: none !important; }
            #vietnam-map { height: 50vh; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-2">
                Vietnam Travel Treasury
            </h1>
            <p class="text-gray-600 text-lg">Di chu·ªôt qua m·ªôt ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ xem b·∫£n t√≥m t·∫Øt nhanh.</p>
        </header>

        <!-- Search bar and filter (positioned above map) -->
        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg mb-8 space-y-4 md:flex md:space-y-0 md:space-x-4">
            <!-- Search Input -->
            <input 
                type="text" 
                id="search-input" 
                placeholder="T√¨m ki·∫øm theo t√™n ƒë·ªãa ƒëi·ªÉm..."
                class="w-full md:flex-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
            >
            <!-- City Filter -->
            <select 
                type="text"
                id="city-filter" 
                class="w-full md:w-1/3 p-3 border border-gray-300 rounded-lg bg-white appearance-none focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                onchange="filterLocations()"
            >
                <option value="">-- L·ªçc theo T·ªânh/Th√†nh ph·ªë --</option>
            </select>
        </div>

        <!-- MAP CONTAINER -->
        <h2 class="text-2xl font-bold text-gray-800 mb-3 text-center">
             üìç B·∫£n ƒë·ªì ƒê·ªãa ƒëi·ªÉm Check-in "S·ªëng ·∫¢o" t·∫°i Vi·ªát Nam üáªüá≥
        </h2>
        <div id="vietnam-map"></div>
        <!-- End Map Container -->

        <!-- Container for the list of locations (Horizontal Slider/Carousel) -->
        <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-4 border-b pb-2">
             Danh s√°ch 10 ƒê·ªãa ƒëi·ªÉm G·ª£i √Ω H√†ng ƒë·∫ßu üìã
        </h2>
        <div 
            id="location-list" 
            class="horizontal-scroll-list"
        >
            <!-- Locations will be rendered here -->
            <p id="loading-message" class="text-center text-gray-500 p-8">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>

        <footer class="mt-10 text-center text-gray-500 text-sm border-t pt-4">
            &copy; 2025 Tourism Data. Summarized data provided by Gemini API & Google Search. Map powered by Leaflet.
        </footer>
    </div>
    
    <!-- PREVIEW CARD (Tooltip for AI Summary) -->
    <div id="preview-card" class="hidden bg-white rounded-xl shadow-2xl p-4 border-t-4 border-indigo-500 transition-all duration-300">
        <div class="text-sm font-bold text-indigo-600 mb-2" id="preview-title"></div>
        <div id="preview-content" class="text-gray-700 text-sm leading-snug"></div>
        
        <div id="preview-loading" class="text-center py-4 hidden">
            <svg class="animate-spin h-5 w-5 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-1 text-sm text-gray-500">ƒêang t√¨m ki·∫øm th√¥ng tin...</p>
        </div>
    </div>

    <script>
        // Data containing 10 popular Vietnam check-in locations
        const rawLocations = [
            // 1. North - Hanoi
            {"name": "Old Quarter (Ph·ªë C·ªï)", "address": "Hoan Kiem District, Hanoi", "lat": 21.0313, "lng": 105.8516},
            // 2. North - Quang Ninh
            {"name": "Ha Long Bay (V·ªãnh H·∫° Long)", "address": "Ha Long City, Quang Ninh", "lat": 20.8710, "lng": 107.0350},
            // 3. North - Lao Cai
            {"name": "Sapa Terraces (Ru·ªông b·∫≠c thang Sa Pa)", "address": "Sapa, Lao Cai", "lat": 22.3390, "lng": 103.8500},
            // 4. Central - Da Nang
            {"name": "Golden Bridge (C·∫ßu V√†ng), Ba Na Hills", "address": "Hoa Vang District, Da Nang", "lat": 16.0123, "lng": 108.0680},
            // 5. Central - Quang Nam
            {"name": "Hoi An Ancient Town (Ph·ªë c·ªï H·ªôi An)", "address": "Minh An Ward, Hoi An City, Quang Nam", "lat": 15.8794, "lng": 108.3360},
            // 6. Central - Hue
            {"name": "Imperial City (ƒê·∫°i N·ªôi Hu·∫ø)", "address": "Hue", "lat": 16.4678, "lng": 107.5707},
            // 7. South - HCMC
            {"name": "Notre-Dame Cathedral (Nh√† th·ªù ƒê·ª©c B√† S√†i G√≤n)", "address": "District 1, Ho Chi Minh City", "lat": 10.7797, "lng": 106.6990},
            // 8. South - Da Lat
            {"name": "Crazy House (Bi·ªát th·ª± H·∫±ng Nga)", "address": "Da Lat, Lam Dong", "lat": 11.9390, "lng": 108.4370},
            // 9. South - Phu Quoc
            {"name": "Bai Sao Beach (B√£i Sao)", "address": "Phu Quoc Island, Kien Giang", "lat": 10.0460, "lng": 104.0480},
            // 10. South - Can Tho
            {"name": "Cai Rang Floating Market (Ch·ª£ n·ªïi C√°i RƒÉng)", "address": "Can Tho", "lat": 10.0075, "lng": 105.7483}
        ];

        // --- JAVASCRIPT & GEMINI API LOGIC AREA ---

        const locationListElement = document.getElementById('location-list');
        const searchInputElement = document.getElementById('search-input');
        const cityFilterElement = document.getElementById('city-filter');
        const previewCard = document.getElementById('preview-card');
        const previewTitle = document.getElementById('preview-title');
        const previewContent = document.getElementById('preview-content');
        const previewLoading = document.getElementById('preview-loading');

        // Map variables
        let vietnamMap;
        let markerClusterGroup;
        let mapMarkers = [];

        // Cache and API Configuration
        const previewCache = {};
        const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";
        const GEMINI_API_KEY = ""; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
        
        // --- INITIAL DATA PROCESSING LOGIC ---

        function extractCity(address) {
            if (!address) return "Other";
            if (address.includes("Ho Chi Minh City") || address.includes("HCM")) return "Ho Chi Minh City";
            if (address.includes("Hanoi") || address.includes("H√† N·ªôi")) return "Hanoi";
            if (address.includes("Quang Nam")) return "Quang Nam (Hoi An)";
            if (address.includes("Da Nang") || address.includes("ƒê√† N·∫µng")) return "Da Nang";
            if (address.includes("Quang Ninh")) return "Quang Ninh (Ha Long)";
            if (address.includes("Lao Cai") || address.includes("L√†o Cai")) return "Lao Cai (Sapa)";
            if (address.includes("Ninh Binh") || address.includes("Ninh B√¨nh")) return "Ninh Binh";
            if (address.includes("Kien Giang") || address.includes("Ki√™n Giang") || address.includes("Phu Quoc")) return "Kien Giang (Phu Quoc)";
            if (address.includes("Lam Dong") || address.includes("L√¢m ƒê·ªìng") || address.includes("Da Lat")) return "Lam Dong (Da Lat)";
            if (address.includes("Hue") || address.includes("Hu·∫ø") || address.includes("Thua Thien Hue")) return "Thua Thien Hue";
            if (address.includes("Can Tho") || address.includes("C·∫ßn Th∆°")) return "Can Tho";
            
            // Default simple extraction for other cities
            const parts = address.split(',').map(p => p.trim());
            return parts[parts.length - 1] || "Other";
        }

        const locations = rawLocations.map(loc => ({
            ...loc,
            city: extractCity(loc.address),
            // Determine region based on latitude (simple approximation for visualization)
            region: loc.lat > 20 ? 'North' : (loc.lat > 14 ? 'Central' : 'South')
        }));

        function populateCityFilter() {
            const cities = new Set(locations.map(loc => loc.city).filter(c => c));
            // S·∫Øp x·∫øp c√°c th√†nh ph·ªë ∆∞u ti√™n hi·ªÉn th·ªã tr∆∞·ªõc
            const priorityCities = ["Hanoi", "Ho Chi Minh City", "Da Nang", "Quang Nam (Hoi An)", "Lam Dong (Da Lat)", "Kien Giang (Phu Quoc)", "Quang Ninh (Ha Long)", "Thua Thien Hue", "Can Tho"];
            const sortedCities = Array.from(cities).sort((a, b) => {
                const aIndex = priorityCities.indexOf(a);
                const bIndex = priorityCities.indexOf(b);
                if (aIndex === -1 && bIndex === -1) return a.localeCompare(b);
                if (aIndex !== -1 && bIndex === -1) return -1;
                if (aIndex === -1 && bIndex !== -1) return 1;
                return aIndex - bIndex;
            });
            
            sortedCities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilterElement.appendChild(option);
            });
        }

        // --- MAP INITIALIZATION AND RENDERING ---

        function initMap() {
            // Safety check: Ki·ªÉm tra L ƒë√£ ƒë∆∞·ª£c t·∫£i ch∆∞a
            if (typeof L === 'undefined' || typeof L.map !== 'function') {
                console.error("Leaflet (L) is not defined or L.map is not a function. Map cannot be initialized. Check script loading order.");
                return;
            }

            // Initialize map centered roughly on Vietnam
            vietnamMap = L.map('vietnam-map', {
                center: [16.0, 107.8], // Central Vietnam
                zoom: 5,
                minZoom: 5,
                maxZoom: 18,
                zoomControl: true 
            });

            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(vietnamMap);

            // Initialize marker cluster group
            markerClusterGroup = L.markerClusterGroup({
                chunkedLoading: true,
                spiderfyOnMaxZoom: true // Cluster functionality
            });
            vietnamMap.addLayer(markerClusterGroup);

            // Force map size recalculation
            setTimeout(() => {
                vietnamMap.invalidateSize();
            }, 10);
        }

        function updateMapMarkers(filteredList) {
            if (typeof L === 'undefined' || !markerClusterGroup) return; // Safety check

            // 1. Clear existing markers
            markerClusterGroup.clearLayers();
            mapMarkers = [];

            // 2. Add markers for filtered locations
            filteredList.forEach(loc => {
                if (loc.lat && loc.lng) {
                    const tooltipContent = `
                        <div class="font-bold text-indigo-700">${loc.name}</div>
                        <div class="text-xs text-gray-600">${loc.address}</div>
                    `;

                    let markerColor;
                    if (loc.region === 'North') markerColor = '#1d4ed8'; // blue-700
                    else if (loc.region === 'Central') markerColor = '#059669'; // emerald-600
                    else markerColor = '#dc2626'; // red-600

                    const customIcon = L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div style="background-color: ${markerColor}; width: 10px; height: 10px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5);"></div>`,
                        iconSize: [14, 14],
                        iconAnchor: [7, 7]
                    });

                    const marker = L.marker([loc.lat, loc.lng], { icon: customIcon })
                        .bindTooltip(tooltipContent, {
                            permanent: false,
                            direction: 'top',
                            offset: [0, -10]
                        });
                    
                    marker.locationData = loc; // Store location data for filtering
                    markerClusterGroup.addLayer(marker);
                    mapMarkers.push(marker);
                }
            });
        }

        // --- PREVIEW & API CALL LOGIC ---
        
        async function retryFetch(url, options, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`API returned status ${response.status}. Body: ${errorBody.substring(0, 100)}...`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                }
            }
            throw new Error("API call failed after multiple retries.");
        }


        async function fetchGoogleSearchPreview(locationName) {
            if (previewCache[locationName]) {
                return previewCache[locationName];
            }

            if (GEMINI_API_KEY === "") {
                const errorMsg = "L·ªñI: Thi·∫øu Kh√≥a API (API Key). Vui l√≤ng cung c·∫•p Kh√≥a Gemini API ƒë·ªÉ k√≠ch ho·∫°t ch·ª©c nƒÉng t√≥m t·∫Øt.";
                return { text: errorMsg, error: true };
            }

            // Prompt Configuration: 5-10 lines summary in English using Google Search
            const systemPrompt = "Act as a professional travel guide. Provide a concise, single-paragraph summary of this tourist location in English, strictly limited to 5-10 lines. Focus on key highlights, history, or recent travel experiences. Do not mention phrases like 'based on search' or 'I found'.";
            const userQuery = `Find the latest information and briefly summarize ${locationName} in Vietnam. Provide the output in English, ensuring it is no more than 10 lines long.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await retryFetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    const data = { text, error: null };
                    previewCache[locationName] = data;
                    return data;

                } else if (result.error?.message) {
                     const errorMsg = `L·ªñ·ªñI API: ${result.error.message}`;
                     previewCache[locationName] = { text: errorMsg, error: true };
                     return previewCache[locationName];
                } else {
                    const errorMsg = "L·ªñI: Kh√¥ng th·ªÉ t·∫°o b·∫£n t√≥m t·∫Øt. C·∫•u tr√∫c ph·∫£n h·ªìi kh√¥ng mong mu·ªën.";
                    previewCache[locationName] = { text: errorMsg, error: true };
                    return previewCache[locationName];
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                const errorMsg = `L·ªñI K·∫æT N·ªêI/M·∫†NG: ${error.message}. Ch·ª©c nƒÉng t√≥m t·∫Øt c√≥ th·ªÉ b·ªã ch·∫∑n ho·∫∑c thi·∫øu API Key.`;
                previewCache[locationName] = { text: errorMsg, error: true };
                return previewCache[locationName];
            }
        }

        function updatePreviewCard(locationName, result) {
            previewTitle.textContent = locationName;
            
            previewLoading.classList.add('hidden');
            previewContent.classList.remove('hidden');

            if (result.error) {
                 previewContent.innerHTML = `<p class="text-red-600 font-bold bg-red-100 p-2 rounded-lg border border-red-300">${result.text}</p>`;
            } else {
                 previewContent.innerHTML = result.text.replace(/\n/g, '<br>');
            }
        }

        async function handleMouseEnter(event) {
            // T·∫Øt ch·ª©c nƒÉng Preview Card tr√™n mobile ƒë·ªÉ tr√°nh che m√†n h√¨nh
            if (window.innerWidth <= 768) return; 

            const target = event.currentTarget;
            const locationName = target.getAttribute('data-name');

            const rect = target.getBoundingClientRect();
            
            // Positioning the card next to the mouse hover location
            let cardX = rect.right + 20; 
            let cardY = rect.top + window.scrollY; 
            
            // Adjust card position if it goes off screen (simple right-side check)
            if (cardX + 320 > window.innerWidth - 20) {
                cardX = rect.left - 320 - 20;
            }
            
            if (cardX < 20) {
                 cardX = rect.right + 20; 
            }
            
            previewCard.style.left = `${cardX}px`;
            previewCard.style.top = `${cardY}px`;
            previewCard.classList.remove('hidden');
            previewCard.style.opacity = '1';

            previewTitle.textContent = locationName;
            previewLoading.classList.remove('hidden');
            previewContent.classList.add('hidden');
            
            try {
                const result = await fetchGoogleSearchPreview(locationName);
                if (locationListElement.contains(target)) { 
                    updatePreviewCard(locationName, result);
                }
            } catch(e) {
                 if (locationListElement.contains(target)) {
                    updatePreviewCard(locationName, { text: "An unknown error occurred while loading data.", error: true });
                }
            }
        }

        function handleMouseLeave() {
            previewCard.classList.add('hidden');
            previewCard.style.opacity = '0';
        }

        // --- RENDER & FILTER LOGIC (Updated for Horizontal Scroll) ---
        
        // Simple placeholder intro based on region/city
        function getPlaceholderIntro(loc) {
            if (loc.city.includes("Hanoi") || loc.city.includes("Ho Chi Minh City")) {
                return "Kh√°m ph√° trung t√¢m vƒÉn h√≥a v√† nh·ªãp s·ªëng ƒë√¥ th·ªã s√¥i ƒë·ªông c·ªßa Vi·ªát Nam.";
            } else if (loc.region === 'North') {
                 return "Tuy·ªát t√°c thi√™n nhi√™n mi·ªÅn n√∫i ph√≠a B·∫Øc v·ªõi v·∫ª ƒë·∫πp h√πng vƒ© v√† ru·ªông b·∫≠c thang.";
            } else if (loc.city.includes("Da Lat")) {
                 return "Th√†nh ph·ªë s∆∞∆°ng m√π, n∆°i l√Ω t∆∞·ªüng cho nh·ªØng ng∆∞·ªùi y√™u th√≠ch ki·∫øn tr√∫c v√† kh√≠ h·∫≠u m√°t m·∫ª.";
            } else if (loc.city.includes("Phu Quoc")) {
                 return "Thi√™n ƒë∆∞·ªùng bi·ªÉn ƒë·∫£o v·ªõi b√£i c√°t tr·∫Øng v√† n∆∞·ªõc bi·ªÉn trong xanh.";
            } else if (loc.region === 'Central') {
                 return "V√πng ƒë·∫•t di s·∫£n v·ªõi nh·ªØng th√†nh ph·ªë c·ªï k√≠nh v√† b√£i bi·ªÉn tuy·ªát ƒë·∫πp.";
            }
            return "ƒê·ªãa ƒëi·ªÉm du l·ªãch ƒë·ªôc ƒë√°o, ƒëang ch·ªù b·∫°n kh√°m ph√° v√† check-in!";
        }

        function renderLocations(filteredList) {
            locationListElement.innerHTML = '';
            
            if (filteredList.length === 0) {
                locationListElement.innerHTML = '<p class="text-center text-xl text-red-500 font-medium p-10 bg-yellow-50 rounded-xl shadow-inner mx-auto w-full">Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm n√†o ph√π h·ª£p v·ªõi ti√™u ch√≠ t√¨m ki·∫øm/l·ªçc.</p>';
                return;
            }

            filteredList.forEach(loc => {
                const item = document.createElement('div');
                item.className = 'loc-card bg-white p-4 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] border border-gray-100 cursor-pointer';
                item.setAttribute('data-name', loc.name);
                
                item.addEventListener('mouseenter', handleMouseEnter);
                item.addEventListener('mouseleave', handleMouseLeave);
                
                // Khi click v√†o card, b·∫£n ƒë·ªì s·∫Ω zoom ƒë·∫øn v·ªã tr√≠ ƒë√≥
                item.addEventListener('click', () => {
                    if (loc.lat && loc.lng && vietnamMap) {
                        vietnamMap.setView([loc.lat, loc.lng], 12);
                    }
                });


                const icon = loc.city.includes("Hanoi") || loc.city.includes("Hue") ? 'üèõÔ∏è' : 
                             loc.city.includes("Ho Chi Minh City") ? 'üèôÔ∏è' : 
                             loc.city.includes("Da Nang") || loc.city.includes("Quang Nam") ? '‚õ±Ô∏è' :
                             loc.city.includes("Phu Quoc") ? 'üèùÔ∏è' :
                             loc.city.includes("Da Lat") || loc.city.includes("Sapa") ? '‚õ∞Ô∏è' : 'üáªüá≥';

                // L·ªùi gi·ªõi thi·ªáu ng·∫Øn g·ªçn (Placeholder intro)
                const shortIntro = getPlaceholderIntro(loc);

                item.innerHTML = `
                    <div class="flex items-center space-x-3 mb-2 border-b pb-2">
                        <span class="text-2xl">${icon}</span>
                        <h2 class="text-lg font-bold text-indigo-600 leading-tight">${loc.name}</h2>
                    </div>
                    <p class="text-xs font-medium text-gray-500 bg-indigo-50 inline-block px-2 py-0.5 rounded-full mb-3">
                        ${loc.city} (${loc.region})
                    </p>
                    <p class="text-sm text-gray-800 mb-2 font-semibold">Gi·ªõi thi·ªáu:</p>
                    <p class="text-sm text-gray-600 italic leading-snug">
                        ${shortIntro}
                    </p>
                    <p class="text-xs text-gray-400 mt-2">
                         (Di chu·ªôt ƒë·ªÉ xem t√≥m t·∫Øt chi ti·∫øt b·∫±ng AI)
                    </p>
                `;
                locationListElement.appendChild(item);
            });
            
            updateMapMarkers(filteredList);
        }

        function filterLocations() {
            const searchTerm = searchInputElement.value.toLowerCase().trim();
            const selectedCity = cityFilterElement.value;

            const filtered = locations.filter(loc => {
                const matchesSearch = loc.name.toLowerCase().includes(searchTerm) || 
                                      loc.address.toLowerCase().includes(searchTerm);
                
                const matchesCity = !selectedCity || loc.city === selectedCity;

                return matchesSearch && matchesCity;
            });

            renderLocations(filtered);
        }

        // --- INITIALIZATION ---

        searchInputElement.addEventListener('input', filterLocations);

        window.onload = () => {
            document.getElementById('loading-message').style.display = 'none'; 
            initMap(); // Initialize the map first
            populateCityFilter();
            renderLocations(locations); // Render locations and populate map
            console.log("App Initialized. Map and filter functions ready."); 
        };
    </script>
</body>
</html>
